{"rule_id": 108, "name": "english-report-of-fhappi-freehosting", "description": "-", "references": ["CVE-2014-6271"], "File_Names": ["advapi.dll", "pacswitch.net", "kernel.dll", "Geocities.jp", "DDOS.TF", "ws2_32.dll", "cndns.com", "Meeting_sum\uff58\uff58.doc", "shellcode.exe", "Plug1.dat", "health.pro", "WS2_32.DLL", "wisers.data", "outlooksysm.net", "0day.jp", "userinit.exe", "Meeting_\uff58\uff58\uff58.doc", "Ri.URZ", "\uff58\uff58\uff580301.wsc", "sina.com", "kernelbase.dll", "Plug9.dat", "kisa.or"], "MD5_Hashes": ["e798a7c33a58fc249965ac3de0fee67b", "cb9a199fc68da233cec9d2f3d4deb081", "b862a2cfe8f79bdbb4e1d39e0cfcae3a", "661d4e056c8c0f6804cac7e6b24a79ec", "7c9689e015563410d331af91e0a0be8c", "0011fb4f42ee9d68c0f2dc62562f53e0"], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKEY_LOCAL_MACHINE\\SYSTEM\\Setup \u306e SystemSetupInProgress\u300d,\nwe'll see the values sent afterward. The next malicious process will be executed too. And these overall process will be\nlooped. I had to terminate the process of loop itself in the 9th time, so I save the data of the Plug1.dat to Plug9.dat.\n\nThe process being executed by the second shellcode can be seen clearly. I made a graph to describe it as per below:\n\nSave web pages as PDF w ith PDFmyURL\n\n\f\u203b\uff09memo: A hand-made diagram I wrote was actually describing the whole process of the shellcode injected via\npowershell.exe, which also having the process traced of the second shellcode. The both shellcode are in interaction\nduring the infection process. \n\n...now it started to sound like a mouse too..it is a mouse!\n\nUp to this point, there is no doubt this is a Poison Ivy.\n\n\uff16\uff0e\uff23\uff2e\uff23 and Network Traffic\n\uff16\uff0e\uff23\uff2e\uff23\n\nSave web pages as PDF w ith PDFmyURL\n\n\fSince time is somewhat limited lets ignore the small stuff and focus on WS2_32.DLL cause it looks interesting. It\nseems that there is a socket(),gethostbyname() and a connect() call. These revealed hostname and IP address for the\ncallback, along with minor information.\n\nThe IP address is a dial-up IP in South Korea.\u2193\n\nNetwork/BGP Information\u2192\u300c61.97.243.15||4766 | 61.97.243.0/24 | KIXS-AS | KR | kisa.or.kr | KRNIC\u300d\n\nSo the hacker was utilizing another country for the CNC purpose, let's see more:\n\nHostname: web.outlooksysm.net\n\nSave web pages as PDF w ith PDFmyURL\n\n\fThis is the used domain's WHOIS info:\n\nDomain Name: outlooksysm.net\nRegistry Domain ID: 10632213\nRegistrar WHOIS Server: grs-whois.cndns.com\nRegistrar URL: http://www.cndns.com\nUpdated Date: 2016-05-27T11:24:02Z\nCreate Date: 2016-05-27T11:19:45Z\nRegistrar Registration Expiration Date: 2017-05-27T11:19:45Z\nRegistrar: SHANGHAI MEICHENG TECHNOLOGY INFORMATION DEVELOPMENT CO., LTD.\nRegistrar IANA ID: 1621\nRegistrar Abuse Contact Email: domain@cndns.com\nRegistrar Abuse Contact Phone: +86.2151697771\nReseller: (null)\nDomain Status: ok https://icann.org/epp#ok\nRegistry Registrant ID:\nRegistrant Name: Liu Ying\nRegistrant Organization: Liu Ying\nRegistrant Street: Nan An Shi Jing Hua Lu 88Hao\nRegistrant City: NanAnShi\nRegistrant State/Province: FuJian\nRegistrant Postal Code: 009810\nRegistrant Country: CN\nRegistrant Phone : +86.13276905963\nRegistrant Phone Ext:\nRegistrant Fax: +86.13276905963\n\nSave web pages as PDF w ith PDFmyURL\n\n\fRegistrant Fax Ext:\nRegistrant Email: missliu6@sina.com\n\nSo we know where this asshole is coming from...\n\nJust analyzing the code is not enough evidence, I needed a safe way to execute PE file to conduct further behavioral\nanalysis. This way I could capture all the CNC/C2 traffic.\u2193\n\nIn this traffic was sent my test PC info (knew this after decoded) \uff08\uff20\u3002\uff20\uff1b\uff1b\n\nSave web pages as PDF w ith PDFmyURL\n\n\fThe first transmission has a size of 256 bytes\u2026this looks interesting\u2026\u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\fSo by looking ups some reference material turns out that this 256 byte transmission is an identifiable traffic pattern\nfor the Poison Ivy RAT. (The Challenge and Response Traffic for Poison Ivy) \u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\fPoison Ivy: Poison Ivy also known as PIVY is a RAT (Remote Administration Tool) , its a back door style malware.\nMany espionage related malware utilize this Poison Ivy kit in APT(Targeted Attacks)\n\n\uff17\uff0e\uff17\uff0eConclusion\n\nThis APT campaign utilized many variants to falsely have the victim download a malicious VBScript , which then\ndownloaded a secondary staged attack .doc file and opening it. Behind this action it quietly executes a\nPowerShell(PowerSploit) attack to infect the victims with Poison Ivy into a process running in memory.\nThis was an unique instance where a modified PowerSploit PoC code was utilized in an APT infection and shows the\npotential dangers of such an attack.\n\nSave web pages as PDF w ith PDFmyURL\n\n\fPoison IVY malware is what was actually injected in the malicious process userinit.exe created or prepared by the\nPowerSploit used shellcode. The concept of infection is fileless, it's avoiding known signature for detection by multiple\nencodings and wraps, and it is also 100% avoiding the original attacker's working territory. This will make the current\nAPT campaign has better chance of success other cases caused by similar payload. \n\nThis APT campaign utilized multiple accounts on Geocities Japan, leading to the possibility that there is a larger APT\ncampaign being conducted. The TPPs of this attack were the first to be recognized in Japan, and after discussing the\nattack with my friends and fellow researchers we have named it \u201cFree Hosting (pivoted) APT PowerSploit Poison Ivy\u201d\n(FHAPPI) \n\nCredit: El Kentaro (FHAPPI Idea and logo\u3001credit), Luffy, Syota Shinogi \u3001Ino Yuji (credit) ++\n\nTo avoid further victims I really hope that the vbiayay1 account on Geocities.jp gets taken down quickly and the\nmalware deleted. I hope that this analysis can help in the investigation and the countering of this threat.\nAlso from the analysis I am certain that the Korean IP address 61.97.243.15 is a CNC for Poison Ivy therefore\nrecommend blocking access to and from this IP.\n\nI also have already contacted Gmail regarding the email sender , the following address were used:\n1. wisers.data@gmail.com\n2. health.pro.demo30@gmail.com\n\nThese accounts can be used in other APT campaigns, so I suggest blocking & start tracing these addresses.\nI also hope that malware source codes and PoC are not shared in public.\n\n\uff18\uff0e\uff18\uff0eSample\n\nI\u2019m still working on this , so I will only share the hashes for the samples.\nI will add the VT URLs once I am done.\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n1.MD5 (Meeting_sum\uff58\uff58.doc)  = 0011fb4f42ee9d68c0f2dc62562f53e0\n2.MD5 (\uff58\uff58\uff580301.ps1)       = b862a2cfe8f79bdbb4e1d39e0cfcae3a\n3.MD5 (Meeting_\uff58\uff58\uff58.doc)   = 0011fb4f42ee9d68c0f2dc62562f53e0\n4.MD5 (\uff58\uff58\uff580301.ps1)       = b862a2cfe8f79bdbb4e1d39e0cfcae3a\n5.MD5 (\uff58\uff58\uff580301.wsc)       = 7c9689e015563410d331af91e0a0be8c\n6.MD5 (shellcode-bin)        = cb9a199fc68da233cec9d2f3d4deb081\n7.MD5 (stupid-shellcode.exe) = 661d4e056c8c0f6804cac7e6b24a79ec\n\nOther samples. (credit: Syota Shinogi)\nMD5 (f0921.ps1)            = e798a7c33a58fc249965ac3de0fee67b\n\n?\n\n\uff19\uff0e\uff19\uff0eUpdate.\n\nSave web pages as PDF w ith PDFmyURL\n\n \n\f\uff19\uff0e\uff11\uff0eFinding other Geocities accounts.\n\uff19\uff0e\uff11\uff0e\n\nThanks to Syota Shinogi\u2019s help (credit) in further researching he found another Geocities Japan account. \nIt uses the same PowerSploit shell code and the .doc file was a document in Mongolian , possibly targeting users in or\nrelated to Mongol.\n\nScreen shot \u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\f\uff19\uff0c\uff12\uff0eFile name contains the APT information\n\uff19\uff0c\uff12\uff0e\n\nURL and attack campaign related information : \u2193\n\nThis shows the attack date, target ID and some form of versioning/series type of information.\n\n\uff19\uff0e\uff13\uff0eThe Deletion process of the APT malware files \n\uff19\uff0e\uff13\uff0e\n\nWith the help of the Yahoo Incident Response Division (YIRD) and JP-CERT/CC and other great security folks in Japan\nthe files was successfully deleted.\n\nThe following files were deleted.\u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\f\u203b\uff09Deletion confirmed time : 2017 March. 11th 10:00 am \n\nthank you all for your help.\n\n\uff19\uff0e\uff14\uff0eFHAPPI Campaign targeting Mongol\n\uff19\uff0e\uff14\uff0e\n\nThe user lgxpoy6\u300dcontains data for Mongolian APT target. The infection vector is the same, judging from the date it\nstarted sometime in September of last year. Many artifacts and web sigs has gone or faded but, what the heck, so\nlets analyze this too for the malware improvement comparison.. \n\nThe first installer script was not obfuscated using base 64. \n\nIt utilizes VBscript but not encoded, and executes powershell.exe directly however the execution process itself is the\n\nSave web pages as PDF w ith PDFmyURL\n\n\fsame as the campaign explained in above.\u2193\n\nThe encode command executed by powershell.exe has the same format \u2193\n\nMongolian Decoy Document \u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\fStill uses PowerSploit to inject the malware into memory , no changes here.\u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\fA slightly different shell code design \u2193\n\nSave web pages as PDF w ith PDFmyURL\n\n\fThe Mongolia related campaign also uses XOR but a different key \u201c0xd4\u201d but the byte length is the same \u201c0x2183\u201d\n\nSave web pages as PDF w ith PDFmyURL\n\n\fThe CNC is in the mainland of China, with the hostname(S) that I will expose later can be seen in screenshots in next\npart)\n\nIP/BGP Information: 116.193.154.28 | 116-193-154-28.pacswitch.net. | AS4766 | JIULINGQIHANG-CN | CN\n\nSave web pages as PDF w ith PDFmyURL\n\n\f(Room 413, No.188, Dong Han Men Nan Lu, CHINA) \n\nThe Poison Ivy version used in the Mongolia campaign is the same as the main analysis shown above that aims "], "URLs": ["http://blog.0day.jp", "https://icann.org/epp", "http://www.cndns.com"], "weight": 0.0}