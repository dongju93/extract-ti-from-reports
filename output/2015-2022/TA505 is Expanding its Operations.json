{"rule_id": 405, "name": "TA505 is Expanding its Operations", "description": "-", "references": [], "File_Names": ["winserv.exe", "ananas.exe", "wprgxyeqd79.exe", "rtegre.exe", "pasmmm.exe", "veter1605_MAPS_10cr0.exe", "exit.exe", "i.cmd", "uninstall.exe"], "MD5_Hashes": [], "SHA1_Hashes": [], "SHA256_Hashes": ["0c88e285b6fc183c96b6f03ca5700cc9ca7c83dfccc6ad14a946d1868d1cc273", "609b0a416f9b16a6df9b967dc32cd739402af31566e019a8fb8abdf3cb573e30", "5310c2397ba4c783f7ee9724711a6da9b5c603b5c9781fff3407b46725e338b3", "fd701894e7ec8d8319bc9b32bba5892b11bdf608c3d04c2f18eff83419eb6df0", "210bb55664d291d82b94b9cea6fcf41029eded9eca6e7fe7b7d58715407a0703", "2b5eefc4bc2d34cbe5093332c47b5405cf5c32e8156767fc8bc9ddd9cdcf3018", "aafa83d5e0619e69e64fcac4626cfb298baac54c7251f479721df1c2eb16bee7", "c69ce39ac3e178a89076136af7418c6cb664844b0ce5cb643912ed56c373a08a", "1ee1ba514212f11a69d002005dfc623b1871cc808f18ddfa2191102bbb9f623b", "6f1a8ee627ec2ed7e1d818d32a34a163416938eb13a97783a71f9b79843a80a2"], "Registry_Entries": ["HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\u201d registry\nkey, creating a new entry named \u201cWindows Anytime Upgrade\u201d which points to\n\u201cwinserv.exe\u201d, just stored into the same folder. Thus, the script provides to run\n\u201cwinserv.exe\u201d.\n\nFigure 7. \u201ci.cmd\u201d script contained in \u201cuninstall.exe\u201d\n\nAn interesting part of the script is the continuous killing of every \u201crundll32.exe\u201d process\nrunning into the victim machine, generates a huge amount of noise, as visible in the\nfollowing process explorer view.\n\n:Repeat\ntaskkill /f /im \u201crundll32.exe\u201d || goto :Repeat\n\nhttps://blog.yoroi.company/research/ta505-is-expanding-its-operations/\n\n6/13\n\n \n \n\f5/29/2019\n\nTA505 is Expanding its Operations \u2013 Yoroi Blog\n\nFigure 8. List of malware\u2019s processes\n\nAnyway, just before the kill loop, the real malicious payload is executed: the\n\u00a0\u201cwinserv.exe\u201d \ufb01le. Analyzing it in depth, we discover it actually is the RMS (Remote\nManipulator System) client by TektonIT, encrypted using the MPress PE compressor\nutility, a legitimate tool, to avoid antivirus detection.\n\nFigure 9. Information about MPress packer used in \u201cwinserv.exe\u201d payload\n\nTektonIT RMS acts as a remote administration tool, allowing the attacker to gain\ncomplete access to the victim machine. Together with the RMS executable, there is\nanother \ufb01le named \u201csettings.dat\u201d containing the custom con\ufb01guration prepared by the\nattacker. It contains information like:\n\nServer address and port the client will connect to\nThe password chosen by the attacker for the remote access\nThe ID associated to the victim client\n\nhttps://blog.yoroi.company/research/ta505-is-expanding-its-operations/\n\n7/13\n\n \n\f5/29/2019\n\nTA505 is Expanding its Operations \u2013 Yoroi Blog\n\nAll these information are automatically loaded by the RMS executable and \ufb01rstly stored\nin the registry key \u201cHKCU\\Software\\tektonik\\Remote MANIPULATOR\nSystem\\Host\\parameters\u201d. At the next startup, the software will directly load the\ncon\ufb01guration from the just created key.\n\nFigure 10. Registry key set by \u201cwinserv.exe\u201d (on the left); \u201csettings.dat\u201d \ufb01le (on the right)\n\nThe client establishes a new connection with the remote command and control server\nhosted on a Bulgarian remote host 217.12.201.159, part of a Virtual Dedicated Server\nsubnet of the AS-21100, operated by ITL LLC.\n\nFigure 11. C2\u2019s parameters\n\nThe attack is composed by a complex \ufb02ow we synthesize in the following scheme:\n\nhttps://blog.yoroi.company/research/ta505-is-expanding-its-operations/\n\n8/13\n\n \n\f5/29/2019\n\nTA505 is Expanding its Operations \u2013 Yoroi Blog\n\nFigure 12. Complete infection chain\n\nThe TA505 Connection\n\nAfter the reconstruction of the full infection chain, we noticed strong similarities with a\nrecent spear-phishing attack campaign against an unspeci\ufb01ed US retail company. The\nattack, as stated by CyberInt, leveraged a command and control server located in\nGermany related to the TA505 actor: a very active group involved in cyber-criminal\noperation all around the world, threatening a wide range of high pro\ufb01le companies,\nactive since 2014.\n\nhttps://blog.yoroi.company/research/ta505-is-expanding-its-operations/\n\n9/13\n\n\f5/29/2019\n\nTA505 is Expanding its Operations \u2013 Yoroi Blog\n\nFigure 13. Comparison between infection chains\n\nThe comparison of the infection chains reveals in both cases the attacker used a couple\nof SFX stages to deploy the \u201cRMS\u201d software: a legitimate remote administration tool\nproduced by the Russian company \u201cTektonIT\u201d. The tool is able to grant remote access\nand full, direct control of the infected machine to the group. Also, some code pieces are\ndirectly re-used in the \u00a0analyzed campaigns, such as the \u201ci.cmd\u201d and \u201cexit.exe\u201d \ufb01les, and,\nat the same time, some new components have been introduced, for instance the\n\u201crtegre.exe\u201d and the \u201cveter1605_MAPS_10cr0.exe\u201d \ufb01le.\n\nDuring the analysis, we also noticed the \u201cveter1605_MAPS_10cr0.exe\u201d \ufb01le slightly\nchanged run after run, a few hours after the initial discovery the infection chain dropped\nit with different icons, different suf\ufb01x, from \u201ccr0\u201d to \u201ccr24\u201d, and appendix from\n\u201cveter1605_\u201d to \u201cveter2005_\u201d. This may indicate the campaign is still ongoing.\n\nConclusion\n\nThe TA505 group is one of the most active threat groups operating since 2014, it has\ntraditionally targeted Banking and Retail industries, as we recently documented during\nthe analysis of the \u201cStealthy Email Stealer\u201d part of their arsenal. The peculiarity of this\nrecent attack wave is it actually hit a company not strictly in the Banking or Retail sector,\nas they recently did, suggesting the threat group could be potentially widening their\ncurrent operations.\n\nIndicators of Compromise\n\nhttps://blog.yoroi.company/research/ta505-is-expanding-its-operations/\n\n10/13\n\n\f5/29/2019\n\nTA505 is Expanding its Operations \u2013 Yoroi Blog\n\nDropurl:\n\nkentona[.su \u2013 47.245.58.124\nhxxps://kentona[.su/xpepriubgpokejifuv7efrhguskdgfjn/ananas.exe\nhxxps://kentona[.su/xpepriubgpokejifuv7efrhguskdgfjn/pasmmm.exe\n\nC2:\n\n217[.12.201.159\n\nPersistence:\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\nHash:\n\n0c88e285b6fc183c96b6f03ca5700cc9ca7c83dfccc6ad14a946d1868d1cc273\n1ee1ba514212f11a69d002005dfc623b1871cc808f18ddfa2191102bbb9f623b\nfd701894e7ec8d8319bc9b32bba5892b11bdf608c3d04c2f18eff83419eb6df0\nc69ce39ac3e178a89076136af7418c6cb664844b0ce5cb643912ed56c373a08a\n5310c2397ba4c783f7ee9724711a6da9b5c603b5c9781fff3407b46725e338b3\naafa83d5e0619e69e64fcac4626cfb298baac54c7251f479721df1c2eb16bee7\n210bb55664d291d82b94b9cea6fcf41029eded9eca6e7fe7b7d58715407a0703\n2b5eefc4bc2d34cbe5093332c47b5405cf5c32e8156767fc8bc9ddd9cdcf3018\n609b0a416f9b16a6df9b967dc32cd739402af31566e019a8fb8abdf3cb573e30\n6f1a8ee627ec2ed7e1d818d32a34a163416938eb13a97783a71f9b79843a80a2\n\nYara Rules\n\nhttps://blog.yoroi.company/research/ta505-is-expanding-its-operations/\n\n11/13\n\n\f5/29/2019\n\nTA505 is Expanding its Operations \u2013 Yoroi Blog\n\nrule excel_dropper { \nmeta: \n    description = "], "URLs": ["https://blog.yoroi.company/research/ta505-is-expanding-its-operations/"], "weight": 0.0}