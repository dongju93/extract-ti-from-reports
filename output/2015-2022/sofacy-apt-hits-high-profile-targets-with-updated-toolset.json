{"rule_id": 744, "name": "sofacy-apt-hits-high-profile-targets-with-updated-toolset", "description": "-", "references": [], "File_Names": ["__tmpdt.tmp", "tf394kv.dll", "snd.dll", "Sofacy.bi", "msdetltemp.dll", "Sofacy.al", "sfc.dll", "IGFSRVC.dll", "Sofacy.bj", "advshellstore.dll", "RUNDLL32.EXE", "chkdbg.log", "NvCpld.dat", "DWN_DLL_MAIN.dll", "conhost.dll", "Sofacy.bf", "sechost.dll", "NvCpld.dll", "Sofacy.bg", "Sofacy.be"], "MD5_Hashes": ["8b238931a7f64fddcad3057a96855f6c", "a96f4b8ac7aa9dbf4624424b7602d4f7", "9D2F9E19DB8C20DC0D20D50869C7A373", "CE8B99DF8642C065B6AF43FDE1F786A3", "ce8b99df8642c065b6af43fde1f786a3", "9d2f9e19db8c20dc0d20d50869c7a373", "8cb08140ddb00ac373d29d37657a03cc", "0369620eb139c3875a62e36bb7abdae8", "f6f88caf49a3e32174387cacfa144a89", "8C4D896957C36EC4ABEB07B2802268B9", "8c4d896957c36ec4abeb07b2802268b9", "c3ae4a37094ecfe95c2badecf40bf5bb", "A96F4B8AC7AA9DBF4624424B7602D4F7", "ce151285e8f0e7b2b90162ba171a4b90"], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run]\n\nStartUpChekTemp=RUNDLL32.EXE \u201c%path to msdeltemp.dll%\u201d,#1\n\nNext, it starts the dropped dll using the same command line:\n\nRUNDLL32.EXE \u201c%path to msdeltemp.dll%\u201c,#1\n\nFinally, the program removes itself by starting the following command: \u201ccmd /c DEL %path to self%\u201c\n\nThe MD5 of the dropped file is f6f88caf49a3e32174387cacfa144a89\n\nInternal name: msdetltemp.dll\n\nFile format: PE32 DLL\n\nFile size: 73 728 bytes\n\nMD5: f6f88caf49a3e32174387cacfa144a89\n\nLinker version: 11.0, Microsoft Visual Studio\n\nLinker timestamp: 2015.02.10 07:20:02 (GMT)\n\nExported functions:\n\n10002B55: Applicate\n\nMost of the strings inside the binary are encrypted using a homebrew XOR-based algorithm and\n\nreversed.\n\nThe library is an older version of the \u201cDWN_DLL_MAIN.dll\u201d (md5:\n\nce8b99df8642c065b6af43fde1f786a3).\n\nThe DllMain function is identical and starts the main thread; the \u201cApplicate\u201d function is identical to the\n\none in the newer library. This version of the module does not rely on an external transport DLL for\n\ncommunicating with its C2 servers; instead it directly uses Wininet API functions.\n\nThe module contains the following hardcoded C2 server names:\n\ndrivres-update[.]info\n\nsoftupdates[.]info\n\nThe module uses a hardcoded URL (\u201c /check/\u201c) for sending HTTP POST requests to its C2 servers.\n\nThe server is expected to send back executable code and one of the following commands:\n\nWrite a new file \u201c%LOCAL_APPDATA%\\svchost.exe\u201d or \u201c%TEMP%\\svchost.exe\u201d and execute it,\n\n\fthen delete the file\n\nWrite a new file \u201c%LOCAL_APPDATA%\\conhost.dll\u201d or \u201c%TEMP%\\conhost.dll\u201d and call its first\n\nexported function using \u201crundll32.exe\u201d or Windows API, then delete the file\n\nRun shellcode provided by the server in a new thread\n\nInternal name: msdetltemp.dll (from resources)\n\nFile size: 50,176 bytes\n\nFile format: PE32 EXE\n\nMD5: 0369620eb139c3875a62e36bb7abdae8\n\nLinker version: 10.0, Microsoft Visual Studio\n\nLinker timestamp: 2015.02.09 11:48:01 (GMT)\n\nMost of the strings inside the binary are encrypted using 3DES and XOR and reversed.\n\nThe program creates the mutex \u201cmtx\u201d and an event named \u201cWerTyQ34C\u201d.\n\nUpon start, it creates a window with the class name \u201cHello\u201d and title \u201cProgram\u201d, subscribes for device\n\narrival notifications for that window and enters a standard Windows message processing loop. The\n\nmessage processing function waits for the WM_DEVICECHANGE event and starts a new thread on its\n\narrival.\n\nThe module inspects every new disk volume attached to the system. For every disk it creates a \u201cstash\u201d\n\ndirectory in \u201c%root stash directory location%\\%volume serial number in hex%\u201d with attributes\n\nFILE_ATTRIBUTE_HIDDEN and FILE_ATTRIBUTE_SYSTEM. The root stash directory location may\n\nbe read from the configuration file or set to the default location which is \u201c%MYPICTURES%\u201d.\n\nThen, it traverses the filesystem of the volume looking for files. Depending on the settings read from the\n\nconfiguration file, the scope may be narrowed to files with particular extensions and/or files created\n\nafter a specified date.\n\nIt is worth noting that if the source file location contains the string \u201cSystem Volume Information\\S-1-5-\n\n21-1315235578-283289242\\\u201d, then the file is deleted after copying to the \u201cstash\u201d directory. There are\n\nknown related samples that are able to create such directories on removable drives, i.e. the sample\n\nwith md5: 8cb08140ddb00ac373d29d37657a03cc.\n\nThe configuration file is loaded from the same directory as the module and is expected to have a name\n\n\u201cNvCpld.dat\u201c. It is a text file that may contain the following configuration parameters:\n\nPath \u2013 location of the root \u201cstash\u201d directory\n\nExt \u2013 search for files with one of these extensions only\n\nDate \u2013 search for files not earlier than this date\n\nInternal name: NvCpld.dll (from export table), msdetltemp.dll (from resources), IGFSRVC.dll (from\n\nresources)\n\n\fFile format: PE32 DLL\n\nFile size: 76,288 bytes\n\nMD5s: 8b238931a7f64fddcad3057a96855f6c, ce151285e8f0e7b2b90162ba171a4b90\n\nLinker version: 11.0, Microsoft Visual Studio\n\nLinker timestamps: 2015.05.29 11:20:32 (GMT), 2006.11.25 04:39:15 (GMT)\n\nExported functions:\n\n10002500: NvMswt\n\n10002860: NvReg\n\n10002880: NvStart\n\n10002A80: NvStop\n\nThis library is a newer version of the file collection module (md5:\n\n0369620eb139c3875a62e36bb7abdae8) wrapped in a DLL file.\n\nThere are two known variants of this module; they only differ in timestamp values and version\n\ninformation in the resource section.\n\nThe DllMain function only decrypts the data structures and initializes Windows API pointers.\n\nThe function \u201cNvMswt\u201d is a wrapper for the API function MsgWaitForMultipleObjects.\n\nThe function \u201cNvReg\u201d is a wrapper for the API function RegisterClassW.\n\nThe function \u201cNvStart\u201d is similar to the main function of the older module; it creates a window and\n\nenters the message loop waiting for device arrival notifications. The only difference introduced is that an\n\nevent named \u201cWerTyQ34C\u201d can be signalled by the function \u201c NvStop\u201d to terminate the message loop\n\nand stop processing.\n\nc3ae4a37094ecfe95c2badecf40bf5bb\n\nce8b99df8642c065b6af43fde1f786a3\n\nf6f88caf49a3e32174387cacfa144a89\n\n8c4d896957c36ec4abeb07b2802268b9\n\n\f0369620eb139c3875a62e36bb7abdae8\n\n8b238931a7f64fddcad3057a96855f6c\n\nce151285e8f0e7b2b90162ba171a4b90\n\nf6f88caf49a3e32174387cacfa144a89\n\na96f4b8ac7aa9dbf4624424b7602d4f7\n\n9d2f9e19db8c20dc0d20d50869c7a373\n\ndrivres-update[.]info\n\nintelnetservice[.]com\n\nintelsupport[.]net\n\nsoftupdates[.]info\n\nTrojan.Win32.Sofacy.al\n\nTrojan.Win32.Sofacy.be\n\nTrojan.Win32.Sofacy.bf\n\nTrojan.Win32.Sofacy.bg\n\nTrojan.Win32.Sofacy.bi\n\nTrojan.Win32.Sofacy.bj\n\nTrojan.Win64.Sofacy.q\n\nTrojan.Win64.Sofacy.s\n\nHEUR:Trojan.Win32.Generic\n\n\fYour email address will not be published. Required fields are marked *\n\nName * \n\nEmail * \n\nWebsite \n\nEnter your comment here\n\nSelect all images with street signs.\n\nreCAPTCHA\n\nWhy this\nCAPTCHA?\n\nVerify\n\n Notify me of follow-up comments by email.\n\n Notify me of new posts by email.\n\n \n\fKaspersky Security Bulletin 2015. Top security stories\n\nRussian financial cybercrime: how it works\n\nKaspersky Security Bulletin. 2016 Predictions\n\nIT threat evolution in Q3 2015\n\nI am HDRoot! Part 2\n\nThe rise of .NET and Powershell malware\n\nAPT Research Discourse at Virus Bulletin 2015\n\nGaza cybergang, where\u2019s your IR team?\n\nSatellite Turla: APT Command and Control in the Sky\n\nNew activity of the Blue Termite APT\n\n\f\u00a9 2015 AO Kaspersky Lab. All Rights Reserved. Registered trademarks and service marks are the property of their respective\n\nowners.\n\nContact us | Read our privacy policy\n\nEvents\n\nIncidents\n\nOpinions\n\nResearch\n\nSpam Test\n\nVirus Watch\n\nWebcasts\n\nContacts\n\nRSS feed\n\nSearch\n\n \n\f"], "URLs": [], "weight": 0.0}