{"rule_id": 693, "name": "CLAMBLING - A New Backdoor Base On Dropbox (EN)", "description": "-", "references": [], "File_Names": ["correomasivochile.com", "secret_file.txt", "S.log", "mircosotfdefender.com", "mircosofdevice.com", "Secret_File.txt", "codex86bin.asc", "S.avi", "Video.exe", "shopingchina.net", "microsoftbetastore.com", "srv2.mkt", "x86bin.asc", "jump.com", "googldevice.com", "codex64bin.asc", "x64bin.asc"], "MD5_Hashes": [], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersio\n\nn\\\\Run  if it has no privileged (Figure 6). Otherwise, it will register itself as a system\n\nservice (Figure 7).\n\nFigure 6. Register as a start program.\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n6/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 7. Register as a system service.\n\nInformation Gathering\n\nIt will collect some basic information like IP address, hostname, username, OS\n\nversion and so on. Also, it will search the registry key\u2019s value\nHKEY_CURRENT_USER\\\\Software\\\\Bitcoin\\\\Bitcoin-Qt  and try to look for\n\nthe wallet address if exist (Figure 8). All of this information will upload to Dropbox as\n%Y-%m-%d %H-%M-%S.log , below is a \ufb01le sample:\n\nLan IP: x.x.x.x \n\nComputer: WIN-XXXXXX \n\nUserName: Administrator \n\nOS: Win10(X64) \n\nVersion: 8.0 \n\nBit: Not Found !!! \n\nExist: NO \n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n7/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 8. Code snippet of information gathering.\n\nRecording Features\n\nThis sample acquired three types of recording features, including key-log, clipboard\nlog, and screen recording. The screen recording \ufb01le naming format is  [%y-%m-%d]\n\n%H-%M-%S.avi . The key-log and clipboard log will encode by di\ufb00erent key and salt,\n\nthen save as  <hash>.pas  for key-log and  <hash>.log  for clipboard log (Figure 9).\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n8/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 9. Code snippet of key log encoding.\n\nConnect to C&C Server\n\nThis sample can also connect to a speci\ufb01c C&C server and send back data by using a\n\nfake HTTP POST request (Figure 10).\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n9/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 10. Code snippet of preparing for fake POST request.\n\nRTTI Information\n\nThe RTTI information remaining, here is the full class name list we got:\n\nCHPAvi\n\nCHPCmd\n\nCHPExplorer\n\nCHPHttp\n\nCHPKeyLog\n\nCHPNet\n\nCHPPipe\n\nCHPPlugin\n\nCHPProcess\n\nCHPProxy\n\nCHPRegedit\n\nCHPScreen\n\nCHPService\n\nCHPTcp\n\nCHPTelnet\n\nCHPUdp\n\nInteract With Dropbox\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n10/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nDuring reverse engineering, we found that the Dropbox API token with 64\n\ncharacters is hardcoded in stack string (Figure 11).\n\nFigure 11. Code snippet for the \ufb01rst 24 characters of Dropbox API token.\n\nBesides connecting to the C&C server, this sample can also upload & download with\n\nDropbox API. Especially when the log \ufb01le is uploaded, it will try to download\nbin.asc  and check the \ufb01le has fake  GIF  \ufb01le header or not. If everything is correct,\n\nit will continue to the custom decoding phase, which will calculate with an array of\n\nbytes hard-coded in the sample, to release the inject payload (Figure 12).\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n11/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 12. Code snippet of interaction with Dropbox API.\n\nInside of Dropbox Folder\n\nAfter we got the Dropbox token, we can now dig into Dropbox by using o\ufb03cial API,\n\nfor example, list the account information which creates this token, list the full \ufb01le\n\nand folder information.\n\nIn the Dropbox, the folder structure like this:\n\n/<unique_hash>/%Y-%m-%d\\ %H:%M:%S.log \n\n/<unique_hash>/bin.asc \n\n/codex64bin.asc \n\n/codex86bin.asc \n\n/x64bin.asc \n\n/x86bin.asc \n\nEach infected victim has its folder named by unique hash  /[0-9A-z]/ , this hash is\n\ngenerated by machine key and some other information.  %Y-%m-%d\\\n\n%H:%M:%S.log  is the log \ufb01le upload by the victim.  *.asc  is the \ufb01le upload by the\n\nthreat actor. For example,  bin.asc  is the payload download by the victim when\n\nthe log \ufb01le is upload succeeds.\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n12/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nSort out the log \ufb01le on Dropbox, we can get the full list of infected computers (Figure\n\n13).\n\nFigure 13. The list of infected computers.\n\nSecond Stage Infection\n\nAfter the \ufb01rst infection stage completed, it will persistent itself as a system service or\n\nautorun program. Collecting information and establish a connection to the C&C\n\nserver. The most interesting part is each time when the log \ufb01le is upload succeeds, it\nwill try to download  bin.asc  from each computer\u2019s unique folder. Most of\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n13/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nbin.asc  we captured is requesting the victim to download  x64bin.asc  \ufb01le from\n\nDropbox.\n\nFurther analysis of  x64bin.asc , we found the second Dropbox API token, its\n\npurpose is di\ufb00erent from the \ufb01rst one. Now the threat actor is ready to use Dropbox\n\nas another C&C server with the full backdoor feature.\n\nThe second infection stage\u2019s sample has some bonus features including the ability\n\nto interact with Dropbox, the command code mapping show as below:\n\nCommand Code Action\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\nListDrives\n\nListFiles\n\nExecuteFile\n\nManageFile\n\nUploadFile\n\nDownloadFile\n\nOpenTerminal\n\nIn these commands, there are three di\ufb00erent \ufb01les, each of these \ufb01le has speci\ufb01c\n\n\ufb01lename and purpose:\n\neLHgZNBH : The status \ufb01le, upload to Dropbox at regular intervals.\n\nyasHPHFJ : The command \ufb01le, containing command and arguments.\n\ncsaujdnc : The execution result of the command.\n\nThe status \ufb01le  eLHgZNBH  contain the basic information about victim and\n\ntimestamp, upload to Dropbox at regular intervals. Whenever status \ufb01le upload\nsucceeds, it will try to download the command \ufb01le  yasHPHFJ  if it existed. Extract\n\nthe command code and arguments from  yasHPHFJ  then execute the command\n\nand upload the execution result to Dropbox as  csaujdnc  (Figure 14).\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n14/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 14. Flow of three \ufb01les interact with Dropbox\n\nBy using this control \ufb02ow, the threat actor can use Dropbox as a C&C server to\n\ncontrol the victim\u2019s computer even the \ufb01xed connection between the speci\ufb01c C&C\n\nserver\u2019s IP address has been found and blocked. Unless we block\ncontent.dropboxapi.com  and  api.dropboxapi.com , otherwise we can not\n\nisolate the infected computer.\n\nThe Dropbox API remain the detail of each \ufb01le and folder, for example this is a \ufb01le\n\ninformation return by Dropbox API:\n\n{ \n\n    '.tag': 'file', \n\n    'name': 'Secret_File.txt', \n\n    'path_lower': '/secret_file.txt', \n\n    'path_display': '/Secret_File.txt', \n\n    'id': 'id:<UNIQUE_FILE_ID>', \n\n    'client_modified': '2019-07-21T02:45:42Z', \n\n    'server_modified': '2019-07-21T02:53:04Z', \n\n    'rev': '[0-9a-f]{6,}', \n\n    'size': 125, \n\n    'is_downloadable': True, \n\n    'content_hash': '<SHA256_HASH>' \n\n} \n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n15/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nIt contains the server_modi\ufb01ed timestamp even with history revision \ufb01le id, we can\nuse  rev  to list the full history of this \ufb01le and download it. Sort out this information\n\nand the command code mapping, we can now list the full command executed on\n\neach computer and its arguments. Here is two computers\u2019 execution list (Figure 15\n\n& 16).\n\nFigure 15. Real command execution list from one victim.\n\nFigure 16. Another real command execution list.\n\nAccording to these record, the threat actor follows almost the same action on every\n\ninfected computer. First, download additional attack programs from Dropbox, like\nmimikatz  or other UAC bypass tools. Second, search the high-value \ufb01le including\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n16/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nprivate source code, con\ufb01g \ufb01le, database, and the key-log / clipboard log. Upload all\n\nof these \ufb01les to Dropbox for further searching. Last but not least, in\ufb01ltrate the\n\ncompany intranet or even the cloud service.\n\nCombining all decoded  yasHPHFJ  \ufb01les, we can show the threat actor\u2019s approximate\n\nworking hours (Figure 17).\n\nFigure 17. The threat actor\u2019s approximate working hours.\n\nConclusion\n\nWe start to monitor the Dropbox for each token and parse the infected computer\u2019s\n\nlist, here we can see the infected computer\u2019s number from July 2019 to September\n\n2019 this two month (Figure 18 & 19).\n\nFigure 18. Dropbox A (\ufb01rst token): infected computer\u2019s number.\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n17/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 19. Dropbox B (second token): infected computer\u2019s number.\n\nWe got nearly 200 infected computers at the highest peak from Dropbox A, alone\n\nwith nearly 80 computers from Dropbox B. Both of these static has a drop at August\n\n21, 2019, the threat actor clear the Dropbox folder for some reason. Monitoring\n\nends on September 20, 2019, all tokens we got are revoked by the threat actor.\n\nDuring these two months, we got \ufb01ve di\ufb00erent Dropbox token. Each of these tokens\n\nhas its purpose. The \ufb01rst two tokens are the major one we discuss in this article,\n\nothers are more like for testing.\n\nFrom the \ufb01rst infection stage, established the connection between the C&C server\n\nand Dropbox at the same time. If the IP address of the C&C server been blocked, it\n\ncan still have limited control from Dropbox. Once it completed the second infection\n\nstage, Dropbox is turning into a second channel C&C server which has full remote\n\ncontrol features (Figure 20). Steal the data and in\ufb01ltrate the whole company. This\n\nmethod is not complex but very useful.\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n18/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nFigure 20. The whole interaction \ufb02ow from infection to interact with Dropbox.\n\nAppendix\n\n1. Loader\n\n33bc14d231a4afaa18f06513766d5f69d8b88f1e697cd127d24fb4\n\nb72ad44c7a\n\nmsmpeng.exe  (PE32)\n\n99042e895b6c2ea80f3ba65563a12c8eba882e3ad6a21dd8e799b0\n\n112c75ddd2\n\nrsoplicy.exe  (PE32+)\n\nDRM.exe  (PE32+)\n\nFirewall.exe  (PE32+)\n\nKaspe.exe  (PE32+)\n\nRSoPProv.exe  (PE32+)\n\nVideo.exe  (PE32+)\n\nWinDRM.exe  (PE32+)\n\n2. DLL & Payload File\n\nmpsvc.dll\n\na58946c10c8325040634f7cd04429b9f1e3715767d0c8aec46\n\nb7cba8975e6a69\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n19/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\ne18af309ecc3bc93351b9fa13a451e8b55b71d9edcc4232bc5\n\n3eb1092bdfa859\n\nEnglish.rtf\n\n52c147c8eadb58d3580b39c023ce4a90dacce76ee5c30c56c5\n\n6ea39939a56b52\n\nb5546d4931a0316abd4018c982558ed808b4d0a60233ac18be\n\ne601fa09d95ee6\n\ndd0399970d2dbb5ab8b5869e2fafb83194c992f27bbb244adc\n\ne35e2fe6ef0d28\n\nmpsvc.mui\n\n0693713f995285e8bd99ebfca2c4f0f1a8e824dafb5a996934\n\n42a9256df06e02\n\n24ebd398be23135a2d8aa7000c2b6a534448b87aa5708b8546\n\n089630a8035f7e\n\n56758c25e3b00957c6f7f76fcea5d0598eff7eda98c63f50b5\n\n1d1c28f267ac8f\n\n96282a625a31b6bf646c6e01ad20de96fd63c345881a9c9119\n\n0940121580059d\n\n99663b9ba27a36ff9fc64b72213e933067ee0cde38b39d20ae\n\n4326a37185811d\n\n9dd1d21e9431cfe25709a8f26ec0f605ed19cf64ca1922e97f\n\nad7b7f2d2e82ea\n\nb226c8e85a7b1a6d4d29d42fc84bc7f3a32335fc7ba44b455a\n\n7716d706660873\n\nbe4efb1b8e3dd4a103dda7d643ffb12022a051857027aa44d8\n\n6a3a710922db87\n\ne716506cf54f48d77382d8955512184b45dd7d0b58c22e3242\n\n4c56d38db24360\n\nOther IoCs\n\nDrop Files\n\n37286285cb0f8305bd23a693b2e7ace71538e4c0b9f13ee6ca\n\n4e9e9419657813\n\nb3581e8611f5838fc205f66bc5ca5edddb0fd895e97ebf8f0c\n\n7220cb102ae14b\n\n79928578cdd646a9724bc6851a1ee77820c81a3100788d6288\n\n5f9d92b6814085\n\n7602e2932a10f3750a5d6236f6c1662047d4475c6e1fe6c571\n\n18c6620a083cb3\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n20/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\n5b5aff8869ba7f1d3f6ad7711e801b031aedeff287a0dcb8f8\n\nae6d6e4eb468af\n\n412260ab5d9b2b2aa4471b953fb67ddc1a0fe90c353e391819\n\nca7ac1c6d3146f\n\nc6064fb44733b5660557e223598d0e4d5c4448ad20b29e41be\n\nf469cb5df77da0\n\n4c08bc1a2f5384c5306edc6f23e4249526517eb21a88763c81\n\n80a582438dfa31\n\na58f2fea8c74c1d25090014c7366db224102daa6c798fcdfb7\n\n168b569b7d5ca2\n\nd201e726fd2a2f4b55ea5ca95f0429d74e2efb918c7c136d55\n\nef392ceac854d6\n\n5713907c01db40cf54155db19c0c44c046b2c676a492d5ba13\n\nd39118c95139bf\n\nd72c3f5f2f291f7092afd5a0fcaceaf2eaae44d057c9b3b27d\n\nd53f2048ed6175\n\nd62ddac7c4aa152cf6f988db6c7bd0c9dcffa2e890d354b7e9\n\ndb7f3b843fd270\n\n28d2637139231c78a6493cd91e8f0d10891cfeb6c5e7585405\n\n15faa29f54b6b2\n\n39e69ab52f073f966945fdab214f63368f71175a7ccbea199f\n\nae32d51fa6a4e7\n\n260b64e287d13d04f1f38d956c10d9fdd3cfbff6ba0040a522\n\n23fa41605bb975\n\nc425b73be7394032aa8e756259ebf3662c000afaa286c3d7d9\n\n57891026f3cbb4\n\n28d19a23d167db3e1282f1c6039bcda6556798be054994a55e\n\n60116827dd0bf1\n\nc3c1fc6aabbb49d0ee281ba4fc1529d2b9832a67b18e08ce14\n\ndbf0e361e5bd85\n\nfc865a720cb808354923092bac04ab6a75e20ea92db5a343af\n\n07365c0cd2b72a\n\n24f501141af5bf059509145e165302dd7087b1d1c2136bc5e4\n\n403f01435f250e\n\nee5f7e6ad4a344f40b9babada1654ea22333bb5150cfd26bfc\n\n239ead28b6528c\n\nca26a34153972cc73c63d3a9aadd3b12ba35ecdc6e39025b75\n\nbe56b00c20e0ae\n\n1951c79f280692a43b7c7cafd45c3f5d7f4f841ae104a6cad8\n\n14fab4641c79f2\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n21/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\nd5129308ee83a852e6a320ca68c8e66ed6d1eb4ec584dd0c8b\n\n5f313a56c49a15\n\nIP\n\n103.230.15.130\n\n104.168.196.80\n\n104.168.196.85\n\n104.168.196.88\n\n139.180.194.173\n\n167.179.115.228\n\n207.148.73.58\n\n43.228.126.172\n\n43.228.126.56\n\n45.32.101.238\n\n45.32.111.228\n\n45.77.41.49\n\n47.75.248.237\n\n66.42.60.107\n\nDomains\n\nfn.shopingchina.net\n\noffice.support.googldevice.com\n\nsafe.mircosofdevice.com\n\nserver.correomasivochile.com\n\nsrv2.mkt-app.com\n\nstore.microsoftbetastore.com\n\nupdate.mircosotfdefender.com\n\nReferences\n\n1. UAC bypass via elevated .NET applications\n\n2. Dropbox for HTTP Developers\n\n3. https://www.trendmicro.com/vinfo/us/security/news/cyber-attacks/operation-\n\ndrbcontrol-uncovering-a-cyberespionage-campaign-targeting-gambling-\n\ncompanies-in-southeast-asia\n\nOlder Post \u21d2\n\nComments\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n22/23\n\n\f2/18/2020\n\nCLAMBLING - A New Backdoor Base On Dropbox (EN) | \u8a6e\u777f\u79d1\u6280\n\n0 Comments\n\ntalentjump\n\n\uf108\n\n Recommend\n\nt Tweet f Share\n\nLogin\ue6031\n\nSort by Best\n\nStart the discussion\u2026\n\nLOG IN WITH\n\nOR SIGN UP WITH DISQUS \n\n?\n\nName\n\nBe the \ufb01rst to comment.\n\n\u2709\n\nSubscribe\n\nd\n\nAdd Disqus to your siteAdd DisqusAdd\n\n\ud83d\udd12\n\nDisqus' Privacy PolicyPrivacy PolicyPrivacy\n\nwww.talent-jump.com/article/2020/02/17/CLAMBLING-A-New-Backdoor-Base-On-Dropbox-en/\n\n23/23\n\n\f"], "URLs": [], "weight": 0.0}