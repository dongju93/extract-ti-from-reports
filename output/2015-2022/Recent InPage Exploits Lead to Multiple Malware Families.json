{"rule_id": 185, "name": "Recent InPage Exploits Lead to Multiple Malware Families", "description": "-", "references": [], "File_Names": ["suit.lnk", "91.inp", "List.inp", "developerbuild.php", "SyLog.log", "sys.argv", "Proof.doc", "SAMPLE.INP", "userveblog.ddns", "fh.read", "SAMPLE.inp", "users.txt", "winopen.exe", "wintasks.exe", "Shellcode.pdb"], "MD5_Hashes": [], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\Putty \u2013\n%TEMP%\\winopen.exe\n\nhttps://unit42.paloaltonetworks.com/unit42-recent-inpage-exploits-lead-multiple-malware-families/\n\n4/15\n\n\u00a0\n \n \n\u00a0\n \n \n\f5/29/2019\n\nRecent InPage Exploits Lead to Multiple Malware Families\n\nFinally, the malware will spawn a new suspended instance of itself, where the decrypted\ndata is written and subsequently executed.\nThis next stage of malware has the following properties:\n\nSHA256\n\nCompile\nTimestamp\n\nbb5540fe0bbc0c\u2010\nda08865aad891a585cd465b224bfe84762216cd04178087516\n\n2017-05-17 05:47:05 UTC\n\nThis malware operates almost identical to the previously witnessed sample. However,\nthis time the embedded resource object is decrypted using the following RC4 key:\n\nkRPAnN2DN6vfrxsJ55Lntnh7Mma8E68s\n\nThe next, and last stage of this malware execution has the following attributes:\n\nSHA256\n\nCompile\nTimestamp\n\nd1a14bc3160f5ed6232ceaf40de1959d7d\u2010\nba3eae614efd2882b04d538cda825b\n\n2016-10-31 02:41:09 UTC\n\nThis \ufb01nal payload is an instance of the CONFUCIUS_B malware family, which we have\npreviously discussed. This particular sample attempts to connect to the following host for\nC2 operations:\n\n151.80.14[.]194\n\nIntelligence Report-561 (1).inp\n\nWe identi\ufb01ed this malicious InPage document as having the following attributes:\n\nSHA256\n\nOriginal\nFilename\n\n35c5f6030513f11fd1dcf9bd232de457ba7f3af3aed\u2010\nc0e2e976895b296a09df6\n\nIntelligence Report-561 (1).inp\n\nThis particular exploit \ufb01le uses the exact same shellcode witnessed previously, where an\nembedded DLL is loaded into memory. Again, this executable drops and executes two\n\ufb01les\u2014a Microsoft Windows executable payload and an InPage decoy document.\nThe embedded payload within the shellcode has the following attributes:\n\nSHA256\n\n83e3b2938ee6a3e354c93c6ec756da96b03c\u2010\nc69118b5748b07aee4d900da1844\n\nhttps://unit42.paloaltonetworks.com/unit42-recent-inpage-exploits-lead-multiple-malware-families/\n\n5/15\n\n \n\u00a0\n \n\u00a0\n \n \n\u00a0\n \n \n\f5/29/2019\n\nRecent InPage Exploits Lead to Multiple Malware Families\n\nCompile\nTimestamp\n\nPDB String\n\n2015-05-08 12:51:54 UTC\n\nc:\\users\\mz\\documents\\visual studio\n2013\\Projects\\Shellcode\\Release\\Shellcode.pdb\n\nAgain, we see the executable payload and decoy document dropped to the following\nrespective locations:\n\n%TEMP%\\winopen.exe\n%TEMP%\\SAMPLE.inp\n\nThe dropped executable is a previously undocumented backdoor written in Delphi that\nhas been named BioData by multiple antivirus organizations.\nThis InPage exploit document follows a much simpler execution \ufb02ow, as seen in the\nfollowing diagram.\n\nFigure 4 InPage exploit execution \ufb02ow\n\nThe decoy InPage \ufb01le dropped by this malware looks like the following. The language\nused within it appears to be a mix of Arabic and Urdu. A rough translation has been\nprovided in red in the image below.\n\nhttps://unit42.paloaltonetworks.com/unit42-recent-inpage-exploits-lead-multiple-malware-families/\n\n6/15\n\n\u00a0\n \n \n \n\u00a0\n \n \n\f5/29/2019\n\nRecent InPage Exploits Lead to Multiple Malware Families\n\nFigure 5 Decoy InPage document dropped by malware\n\nThe Biodata payload has the following attributes:\n\nSHA256\n\nCompile\nTimestamp\n\n5716509e4cdbf8ffa5f\u2010\nbce02b8881320cb852d98e590215455986a5604a453f7\n\n1992-06-19 22:22:17 UTC\n\nNote that the timestamp above is the result of this sample being compiled in Delphi,\nwhich uses the same hardcoded compilation timestamp for all samples that are\ngenerated.\nThroughout the execution of this sample, numerous strings are decoded using a\ncustomized 94-character substitution table. BioData will go through each character of the\nobfuscated string, and will replace each character based on the following table:\n\nFigure 6 Substitution table used by BioData\n\nhttps://unit42.paloaltonetworks.com/unit42-recent-inpage-exploits-lead-multiple-malware-families/\n\n7/15\n\n\u00a0\n \n\u00a0\n \n \n \n\f5/29/2019\n\nRecent InPage Exploits Lead to Multiple Malware Families\n\nThe malware proceeds to generate and create a \u2018Document\u2019 folder within the\n%USERPROFILE% directory. This folder will contain all of the malware\u2019s \ufb01les throughout\nits execution. In order to maintain persistence, the malware will generate the following\n\ufb01le in the startup folder, which points to the current path of the BioData executable:\n\nAdobe creative suit.lnk\n\nBioData proceeds to generate a randomized 30-character string of uppercase and\nlowercase letters. This string is written to the following \ufb01le:\n\n%USERPROFILE%\\Document\\users.txt\n\nThis 30-character string is used by the malware to act as a unique identi\ufb01er for the\nvictim, and will be used for all network communication with a remote server.\nThe username and computer name are identi\ufb01ed, and are written to a string of the\nfollowing format:\n\nUser name and System Name :- [Username]_[Computer Name]\n\nThis data is obfuscated and written to the following \ufb01le:\n\n%USERPROFILE%\\Document\\SyLog.log\n\nIn order to obfuscate this data, the malware uses a unique algorithm. Represented in\nPython, the following script will decode this \ufb01le:\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\nimport sys\nfrom binascii import *\n\ufb01le = sys.argv[1]\nfh = open(\ufb01le, 'rb')\nfd = fh.read()\nfh.close()\ndef bit_not(n, numbits=8):\n\u00a0\u00a0return (1 << numbits) - 1 - n\ndef decode(data):\n\u00a0\u00a0c = 0\n\u00a0\u00a0output = "], "URLs": ["https://unit42.paloaltonetworks.com/unit42-recent-inpage-exploits-lead-multiple-malware-families/", "http://zmwardrobe[.]com/wp-sign", "http://errorfeedback[.]com/MarkQuality455/developerbuild.php", "http://errorfeedback[.]com/MarkQuality455/developerbuild.php?", "http://errorfeedback[.]com/MarkQuality455/bzGwXILtkMRZaJxzciXAeCYviduBuy/malware.exe"], "weight": 0.0}