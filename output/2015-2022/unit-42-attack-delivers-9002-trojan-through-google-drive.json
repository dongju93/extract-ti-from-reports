{"rule_id": 394, "name": "unit-42-attack-delivers-9002-trojan-through-google-drive", "description": "-", "references": [], "File_Names": ["comyahoo.com", "RealNetwork.exe", "Symposium.zip", "MPAMedia.dll", "Symposium.exe"], "MD5_Hashes": [], "SHA1_Hashes": [], "SHA256_Hashes": ["f76f639f2a7b8f39abf83737c6d3e533be66398c85ec95526e4b13561e15fbae", "0940602e7d47941f36c975afa9d2c6b1b0d2bd15bbea6ad4baf0f828420d72bf", "53671fe98a0c8c85f6f8eabfa851e27b437f6c392b46e42ddea3f0a656591b12", "0af768b4ba8fe7aac7a7da7fd5f21e7496d5617dccdf2321f526fd1091d64a6d", "c11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3", "3a9ab623c8a0a9f6c65e108e83c90da7620d2d6b22192c857556117587d0d038", "269c03e205c403ab8fa1033caa1c8e3a86a1495cc33a7f3a3a3c9b8a9ea77490", "f0ab826ea65b4a9eb66528ad74c4d3e747c1ecebfca6bdafd2504e0f794195d9", "C11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3", "fd21cd1846f25d42b1997ec1fd5ae6e14ea9b5bb0161ab7edf0ce184174e6da6", "08dee1f5ced372716ad5c6e3f2041bcdeb25e905efc19d3749fe637d0a589ccc", "193ae4da14874aa29902052d08064395afa5e4763f949e7369157d893fa08653", "ac8fc264c7ec3cf70836e1bb21f9a20174b04ad49731b8797d7d8bb95cb353e2", "e2fb4a53e54774f1645c940f905e76beb5fc729e9e968b736b8377312cb2454a", "49ac6a6c5449396b98a89709b0ad21d078af783ec8f1cd32c1c8b5ae71bec129", "6bdd45cb6c021512c203cf01a051dce28449e364627e1366412c0051094f60a0", "10d40c51d85ea9ced6050b8951802aaebe81f7db13f42fe5a5589172af481a7e", "12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8"], "Registry_Entries": ["HKCU\\Software\\Microsoft\\F6\\uid\n\nThe Trojan uses the path stored in this registry key to locate its configuration, which it decrypts\n\nusing a multiple-byte XOR algorithm and a key of \u201c1pKFmjw\u201d. Figure 7 shows a hexdump of the\n\ndecrypted configuration for this sample of 9002.\n\n\fFigure 7 9002 Trojan\u2019s configuration\n\nUsing the configuration file above, the 9002 Trojan communicates with the following domain that\n\nacts as its command and control (C2) server:\n\nlogitechwkgame[.]com\n\nThe Trojan sends network beacons to its C2 server using two different methods. The first\n\nmethod, seen in Figure 8 uses a custom protocol on TCP port 80 that begins with the string\n\n\u20189002\u2019, which is the basis of the tool\u2019s name. If the C2 server responds, the Trojan will send\n\nsystem specific information along with the strings \u201cjackhex\u201d and \u201c2016\u201d from the configuration\n\nfile. \u201cjackhex\u201d has also been seen in a C2 for what is likely related Poison Ivy activity, discussed\n\nbriefly later in this blog.\n\nFigure 8 Network beacon using custom 9002 protocol\n\nThe second beacon method also uses TCP port 80, but this method uses HTTP requests to\n\ncommunicate with its C2 server. Figure 9 shows a sample HTTP request issued by this Trojan,\n\nwhich has a user-agent of \u201clynx\u201d and POST data of \u201cAA\u201d that are both hardcoded into the\n\npayload.\n\nFigure 9 Network beacon from 9002 using HTTP request\n\nThe two beacons seen generated by this payload are very similar to those generated by the\n\n\u20183102\u2019 variant of 9002 that we previously analyzed. The capabilities within this 9002 sample are\n\nvery similar to the 3102 variant discussed, as its main functionality is to load plugins provided by\n\nthe C2 server and call an exported function named \u201cCreatePluginObj\u201d.\n\nThe C2 server \u2018logitechwkgame[.]com\u2019 resolves to the IP address \u2018222.239.91[.]30\u2019, which also\n\n\fresolved to \u2018admin.nslookupdns[.]com\u2019 at the same time as \u2018logitechwkgame[.]com\u2019, suggesting\n\nthat these two domains are associated with the same threat actors. \u2018admin.nslookupdns[.]com\u2019\n\nwas found to also be a C2 for Poison Ivy samples associated with attacks on Myanmar and\n\nother Asian countries as discussed in a blog published by Arbor Networks. An additional tie\n\nbetween the activity is the Poison Ivy C2 \u2018jackhex.md5c[.]net\u2019, as \u201cjackhex\u201d is not a common\n\nword or phrase and is also seen in the beacon activity with the previously discussed 9002\n\nsample.\n\nIn addition to those noted in the blog by Arbor Networks, we found several other Poison Ivy\n\nsamples using the same mutex, created by the same parent processes, and using most of the\n\nsame C2 infrastructure. However, the samples we collected lack campaign IDs and all use\n\n\u201cversion2013\u201d as the password to encrypt its communications. The additional Poison Ivy\n\nsamples also provided us three new C2 domains:\n\nouthmail[.]com\n\nmxdnsv6[.]com\n\nmicrosoftserve[.]com\n\nAlso, some of the C2 domains associated with these Poison Ivy samples were registered with\n\nemails that were used to register the following possibly related domains:\n\ngooledriveservice[.]com\n\nqueryurl[.]com\n\nappupdatemoremagic[.]com\n\nWhile we do not have complete targeting information associated with these samples, several of\n\nthe decoy files were in Chinese and appear to be part of a recent and possibly ongoing\n\ncampaign targeting organizations in Taiwan. The decoy themes centered primarily around\n\ncross-strait relations and the Taiwanese Mainland Affairs Council (MAC), which is a cabinet-level\n\norganization tasked with creating, implementing, and overseeing policies between Taiwan and\n\nthe People\u2019s Republic of China (PRC).\n\nThe use of Google Drive to host malicious files is not a new tactic in attacks. However, using a\n\nwell-known hosting platform may allow the downloading of a payload to blend into other\n\nlegitimate traffic from the hosting provider. The actors still use spear phishing as their primary\n\nattack method, but because that technique has been so well publicized, intended victims are\n\nperhaps more cautious about opening suspicious email attachments or links. As spear phishing\n\nbecomes less successful, threat actors need to continue to adapt and find new methods to\n\nsuccessfully deliver malware. The use of a URL shortening service and a redirection server\n\nfurther aids the chances of a successful attack, as it becomes more challenging to determine\n\nthe validity of the link within an email due to the way link shorteners obfuscate link content.\n\nThe files used in these attacks are properly classified as malware by WildFire. AutoFocus\n\ncustomers can find out more about both 9002 and Poison Ivy via the respective malware family\n\ntags.\n\n9002 samples\n\nC11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3\n\n49ac6a6c5449396b98a89709b0ad21d078af783ec8f1cd32c1c8b5ae71bec129\n\nPoison Ivy samples\n\n193ae4da14874aa29902052d08064395afa5e4763f949e7369157d893fa08653\n\nac8fc264c7ec3cf70836e1bb21f9a20174b04ad49731b8797d7d8bb95cb353e2\n\n12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8\n\n0940602e7d47941f36c975afa9d2c6b1b0d2bd15bbea6ad4baf0f828420d72bf\n\n6bdd45cb6c021512c203cf01a051dce28449e364627e1366412c0051094f60a0\n\nf0ab826ea65b4a9eb66528ad74c4d3e747c1ecebfca6bdafd2504e0f794195d9\n\ne2fb4a53e54774f1645c940f905e76beb5fc729e9e968b736b8377312cb2454a\n\n0af768b4ba8fe7aac7a7da7fd5f21e7496d5617dccdf2321f526fd1091d64a6d\n\nfd21cd1846f25d42b1997ec1fd5ae6e14ea9b5bb0161ab7edf0ce184174e6da6\n\n12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8\n\n08dee1f5ced372716ad5c6e3f2041bcdeb25e905efc19d3749fe637d0a589ccc\n\n269c03e205c403ab8fa1033caa1c8e3a86a1495cc33a7f3a3a3c9b8a9ea77490\n\n3a9ab623c8a0a9f6c65e108e83c90da7620d2d6b22192c857556117587d0d038\n\nC2 Domains\n\nlogitechwkgame[.]com\n\njackhex.md5c[.]net\n\n\fwebserver.servehttp[.]com\n\nadmin.nslookupdns[.]com\n\nouthmail[.]com\n\nmxdnsv6[.]com\n\nmicrosoftdefence[.]com\n\nmicrosoftserve[.]com\n\ngooledriveservice[.]com\n\nqueryurl[.]com\n\nappupdatemoremagic[.]com\n\nName *\n\nEmail *\n\nWebsite\n\nPost Comment\n\nPrivacy Policy   Legal Notices   Site Index   Subscriptions\n\nCopyright \u00a9 2007-2013 Palo Alto Networks\n\n\f"], "URLs": ["http://tinyurl[.]com/jfj9ouv", "http://222.239.91[.]152/?ZmFrZUBnbWFpbC5jb215YWhvby5jb20", "http://222.239.91[.]152/?ZmFrZUBnbWFpbC5jb21odHRwOi8veWFob28uY29t", "http://yahoo.com"], "weight": 0.0}