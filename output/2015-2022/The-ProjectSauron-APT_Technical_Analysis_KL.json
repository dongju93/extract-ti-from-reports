{"rule_id": 393, "name": "The-ProjectSauron-APT_Technical_Analysis_KL", "description": "-", "references": [], "File_Names": ["FakeVirtualEncryptedNetwork.exe", "A0000003.dll", "symnet32.dll", "knatt.sys", "secret_data_on_usb_drive.docx", "VirtualEncryptedNetwork.ini", "kblog.blob", "0004.bak", "packet.dll", "w.exec", "mfc64d.dll", "mytrampoline.blob", "settings.cfg", "s.dir", "string.find", "FakeVirtualEncryptedNetwork.dll", "data.bin", "FakeVirtualEncryptedNetwork.cfg", "whatismyipaddress.com", "FakeVirtualEncryptedNetwork.EXE", "A0000001.ini", "important_document.doc", "busmain.dll", "bikessport.com", "string.gsub", "string.len", "string.sub", "document.pdf", "icmp.dll", "0005.bak", "VirtualEncryptedNetworkEMail.key", "domain.com", "nps.sys", "w.set", "onpusher.blob"], "MD5_Hashes": ["EB8D5F44924B4DF2CE4A70305DC4BD59", "5D41719EB355FDF06277140DA14AF03E", "63780A1690B922045625EAD794696482", "CA05D537B46D87EA700860573DD8A093", "71EB97FF9BF70EA8BB1157D54608F8BB", "AC8072DFDA27F9EA068DCAD5712DD893", "D2065603EA3538D17B6CE276F64AA7A2", "46a676ab7f179e511e30dd2dc41bd388", "FCA102A0B39E2E3EDDD0FE0A42807417", "2382A79F9764389ACFB4CB4692AA044D", "8D02E1EB86B7D1280446628F039C1964", "EDB9E045B8DC7BB0B549BDF28E55F3B5", "e710f28d59aa529d6792ca6ff0ca1b34", "93C9C50AC339219EE442EC53D31C11A2", "5DDD5294655E9EB3B9B2071DC2E503B1", "A277F018C2BB7C0051E15A00E214BBF2", "c3f8f39009c583e2ea0abe2710316d2a", "F59813AC7E30A1B0630621E865E3538C", "4728A97E720C564F6E76D0E22C76BAE5", "181c84e45abf1b03af0322f571848c2d", "6CA97B89AF29D7EFF94A3A60FA7EFE0A", "A5588746A057F4B990E215B415D2D441", "1511F3C455128042F1F6DB0C3D13F1AB", "914C669DBAAA27041A0BE44F88D9A6BD", "5373C62D99AFF7135A26B2D38870D277", "44C2FA487A1C01F7839B4898CC54495E", "6CD8311D11DC973E970237E10ED04AD7", "7261230A43A40BB29227A169C2C8E1BE", "FC77B80755F7189DEE1BD74760E62A72", "C8C30989A25C0B2918A5BB9FD6025A7A", "B6FE14091359399C4EA572EBF645D2C5", "814CA3A31122D821CD1E582ABF958E8F", "C58A90ACCC1200A7F1E98F7F7AA1B1AE", "0C4A971E028DC2AE91789E08B424A265", "01AC1CD4064B44CDFA24BF4EB40290E7", "2054D07AE841FCFF6158C7CCF5F14BF2", "F01DC49FCE3A2FF22B18457B1BF098F8", "F7434B5C52426041CC87AA7045F04EC7", "2A8785BF45F4F03C10CD929BB0685C2D", "F0E0CBF1498DBF9B8321D11D21C49811", "B98227F8116133DC8060F2ADA986631C", "91BB599CBBA4FB1F72E30C09823E35F7", "F3B9C454B799E2FE6F09B6170C81FF5C", "76DB7E3AF9BE2DFAA491EC1142599075", "0C12E834187203FBB87D0286DE903DAB", "85EA0D79FF015D0B1E09256A880A13CE", "2e460fd574e4e4cce518f9bc8fc25547", "0209541DEAD744715E359B6C6CB069A2", "951EBE1EE17F61CD2398D8BC0E00B099", "F936B1C068749FE37ED4A92C9B4CFAB6", "1f6ba85c62d30a69208fe9fb69d601fa", "72B03ABB87F25E4D5A5C0E31877A3077", "17DEB723A16856E72DD5C1BA0DAE0CC7", "FCD1A80575F503A5C4C05D4489D78FF9", "2F49544325E80437B709C3F10E01CB2D", "57C48B6F6CF410002503A670F1337A4B"], "SHA1_Hashes": [], "SHA256_Hashes": ["EFEB0A9C6ABA4CF5958F41DB6A31929776C643DEDC65CC9B67AB8B0066FF2492"], "Registry_Entries": ["HKEY_LOCAL_MACHINE\\\\Software\\\\VirtualEncryptedNetwork\\\\Components\\", "HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\", "HKLM\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters] NullSessionPipes \n\nprovided \n\ncreates \n\nnamed \n\nname \n\nusing \n\npipe \n\na \n\na \n\nin \n\nthe \n\nconfig: \n\nIf the values does not contain the name of the pipe provided in the config, it appends it to the list and updates \nthe registry value. \n\nThen it creates the pipe \\\\.\\PIPE\\%pipe_name% and waits for incoming connections on the pipe. \n\nOnce an  incoming connection is accepted, it performs a key exchange based on the RSA key provided by the \nconfiguration, and using two hardcoded 16-byte \u201cmagic\u201d strings as challenge-response markers. After the \nhandshake succeeds, it uses two 128-bit session keys for encrypting further communication with AES. \n\nAfter that, the module is expects to receive the encrypted commands from the pipe: \n\n1 \n\n2 \n\n3 \n\n4 \n\n5 \n\n6 \n\nRead arbitrary file's contents and optionally delete it after \n\nWrite arbitrary file \n\nEnumerate files in a directory \n\nDelete a file \n\nLaunch a standard 0xC102AA02 blob provided by the server \n\nnone \n\nFor any inquiries, contact intelreports@kaspersky.com  \n\n          Page 7 of 33 \n\n \n \n \n \n \n \n \n\fThe ProjectSauron APT. Technical analysis \n\n7 \n\n8 \n\n9 \n\nBind on socket and wait incoming connection or connect to a remote host \n\nBind or connect and execute the succeeding shellcode passing the socket handle to it \n\nIdentify if the machine is 64-bit or not \n\nPipe and internet backdoor \n\nSamples: \n\nMD5 \n\nSize \n\nFormat  Bits  Linker \n\nCompilation \ntimestamp \n\n0C4A971E028DC2AE91789E08B424A265 \n\n157696  DLL \n\n64 \n\n9.0 \n\n2009.07.13 23:31:13 \n\n44C2FA487A1C01F7839B4898CC54495E \n\n152576  DLL \n\n64 \n\n9.0 \n\n2009.07.13 23:31:13 \n\nF01DC49FCE3A2FF22B18457B1BF098F8 \n\n155648  DLL \n\n64 \n\n9.0 \n\n2009.07.13 23:31:13 \n\nF59813AC7E30A1B0630621E865E3538C \n\n145408  DLL \n\n64 \n\n9.0 \n\n2009.07.13 23:31:13 \n\nCA05D537B46D87EA700860573DD8A093 \n\n95232  DLL \n\n32 \n\n9.0 \n\n2009.07.14 01:03:45 \n\n01AC1CD4064B44CDFA24BF4EB40290E7 \n\n115200  DLL \n\n64 \n\n9.0 \n\n2009.07.14 01:24:44 \n\n1511F3C455128042F1F6DB0C3D13F1AB \n\n115200  DLL \n\n64 \n\n9.0 \n\n2009.07.14 01:24:44 \n\n57C48B6F6CF410002503A670F1337A4B \n\n115200  DLL \n\n64 \n\n9.0 \n\n2009.07.14 01:24:44 \n\nEDB9E045B8DC7BB0B549BDF28E55F3B5 \n\n105984  DLL \n\n64 \n\n9.0 \n\n2009.07.14 01:24:44 \n\nThe DLL libraries are installed as a Security Providers. \n\nThis module  employs  a  different  kind  of  encryption by  using a custom  virtual  machine  for  decrypting  its \npayload. The final artefact of decryption is a standard blob that is then started as usual. The configuration \ndata in the shellcode is also stored in a unique format of several encrypted records. \n\nThe blob contains the actual Trojan component. The configuration blob consists of two records: the first one \nis the actual config data including the C2 URL, and the second is another standard blob that has a special \ndeinstallation library and its own configuration data inside. \n\nThe configuration contains the following data: \n\n0x101 \n\n0x102 \n\n0x301 \n\nRSA key \n\nExponent \n\nFormat string for a file name. Its default value is ", "HKCU\\Settings] Policy \n\n[HKLM\\System\\CurrentControlSet\\Control\\SecurityProviders] Signature \n\n[HKLM\\System\\CurrentControlSet\\Control\\Lsa] Signature \n\nAn example of the decrypted configuration file: \n\n.*account.*|.*acct.*|.*domain.*|.*login.*|.*member.*|.*user.*|.*name|.*email|.*_id|id|uid|mn|mailaddress|.*nick.*|alias|\ncodice|uin|sign-in|strCodUtente|.*pass.*|.*pw|pw.*|additional_info|.*secret.*|.*segreto.* \n[^\\$]$ \n^.*\\.(doc|xls|pdf)$ \n\nFor any inquiries, contact intelreports@kaspersky.com  \n\n          Page 33 of 33 \n\n \n \n \n \n \n \n \n \n\fContact us at: intelligence@kaspersky.com\n\nSecurelist, the resource for \nKaspersky Lab experts\u2019 \ntechnical research,  \nanalysis, and thoughts.\n\nFollow us\n\n\u2003Kaspersky Lab global Website\n\n\u2003Eugene Kaspersky Blog\n\n\u2003Kaspersky Lab B2C Blog\n\n\u2003Kaspersky Lab B2B Blog\n\n\u2003Kaspersky Lab security news service\n\n\u2003Kaspersky Lab Academy\n\n \n\f"], "URLs": ["http://whatismyipaddress.com/"], "weight": 0.0}