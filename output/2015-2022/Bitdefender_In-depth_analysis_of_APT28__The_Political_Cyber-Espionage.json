{"rule_id": 1019, "name": "Bitdefender_In-depth_analysis_of_APT28__The_Political_Cyber-Espionage", "description": "-", "references": [], "File_Names": ["AC_VTS_\u00d0\u00ca\u00d2.dbx", "advstoreshell.dll", "gen_ip.py", "ore.net", "svehost.exe", "www.msc", "Pr.dll", "backup2.pst", "xp.exe", "winloat.exe", "03.py", "te.info", "backup.pst", "1c9.xml", "run.exe", "43.py", "ter.info", "4076.pdb", "vw.com", "pr.dll", "Kydla.dbx"], "MD5_Hashes": ["2683624eacc490238e98c449bddbb573", "78450806E56B1F224D00455EFCD04CE3", "f3bf929a35c3f198226b88537d9ccb1a", "5bf524a4860f3c33e3ad77b6b625db37"], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\\n2. \nPath). It contains almost the same data as the msd file except for the first two domain names that are changed to win[redacted]\nore.net and micr[redacted]er.com.\n\nThis was the only component that was set to run at startup. This was achieved by creating the value AdvancedStorageShell in HKCU\\\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run with the contents: \n\n\u201cRUNDLL32.EXE \u201cC:\\Documents and Settings\\<user-name>\\Local Settings\\Application Data\\Microsoft Help\\advstorshell.dll\u201d, InitW\u201d\n\n[22]\n\nWhite Paper\fCampaign id\n\n?\n\nMain domain name\n\nKeylogging flag\n\n?\n\nThe configuration file (msd) file is encrypted using the algorithm described above and is 122 bytes long. It contains the following information:\n\nThe backdoor is highly advanced and supports 26 commands. We analyzed some of the supported commands, while the analysis for the \nrest is still in progress. \n\nTimeout1\n\nTimeout2\n\nName\n\nnames\n\nCampaign id\n\n?\n\n?\n\nflag\n\nComputer \n\nTwo domain \n\nKeylogging \n\nMain \n\ndomain \n\nname\n\nTimeout1 = 60000 ; represents the number of miliseconds until timeout is reached when contacting the C&C\n\nTimeout2 = 60000 ; represents the number of miliseconds until timeout is reached when using contacting the C&C using encryption\n\nComputer name = DAE13WS01204030501 ; The name of the infected computer\n\nDomainName1= micro**********ter.info\n\nDomainName2=dri********te.info\n\nCampaign id = rhbp ; we are still investigating the meaning of this field, but it is very likely a campaign identifier\n\n? = 1000 ; we are still investigating the role of this field, although preliminary information leads us to believe that it is used as a counter\n\n? = 600000; we are still investigating the meaning of this field, but it is very likely another timeout value\n\nKeylogging flag = 1; this indicates whether the backdoor should intercept keystrokes and send them to the C&C server.\n\n\u2022  Main domain name = 1***.net ; this is the first domain that the malware tries to connect\n\nc. \n\nBackdoor Component:\n\n5 \n\n6 \n\n9 \n\nfind file\n\nget file content and timestamps\n\nenumerate registry keys and values\n\n10  \n\nset registry value\n\n11 \n\n13 \n\n14 \n\n16 \n\n17\n\n19\n\n21\n\n25\n\ndelete registry value\n\nstart process using CreateProcess\n\nkill process by id\n\nstart process using cmd /c\n\nlist drives and types\n\nread file from offset\n\nget system info (run systeminfo in cmd)\n\ncreate thread\n\nThe most important component of APT28 is the backdoor, in this case, the file called advstoreshell.dll. This file reads the configuration \n\nfile (msd) and contacts the C&C servers indicated in the configuration file.  It can also read the configuration file from the registry. The \n\nconfiguration stored in the registry is probably obtained via update from one of the C&C servers.\n\nWhen running a command using the cmd /c option, the output is saved in a file named tmp.dat\n\nCommunication  between  this  component  and  the  C&C  server  is  carried  out  on  port  HTTP  (443).  If  this  is  not  possible,  it  attempts  to \nconnect on port 80. In some cases, the communication is encrypted using 3DES and RSA.\n\nOn the system we have analyzed, there were two configurations:\n\nThe first one being the msd file that was located in the same path with advstoreshell.dll\n\nOne important function of this backdoor is that it can load external components. It can achieve this goal by calling the init function of \nany dll. This is how the s plugin is loaded.\n\nThe  second  one  was  found  in  registry  (HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\\n\nPath). It contains almost the same data as the msd file except for the first two domain names that are changed to win[redacted]\n\nore.net and micr[redacted]er.com.\n\nThis was the only component that was set to run at startup. This was achieved by creating the value AdvancedStorageShell in HKCU\\\n\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run with the contents: \n\n\u201cRUNDLL32.EXE \u201cC:\\Documents and Settings\\<user-name>\\Local Settings\\Application Data\\Microsoft Help\\advstorshell.dll\u201d, InitW\u201d\n\nWhere:\n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n\u2022 \n\n1. \n\n2. \n\n[23]\n\nWhite Paper\fAppendix 6 - Additional module\n\nThe final component installed by APT28 is a module named pr.dll. This file was compiled 5 hours after the system was compromised. \nThis discrepancy in time prompts us that the file is individually crafted for each target system.\n\nThe file seems to be a modular framework that can accommodate different modules. It stores its configuration in an encrypted format, and \nsaves it in the Registry key \u201cHKU\\S-1-5-19_Classes\\Software\\Microsoft\\MediaPlayer\\{some_clsid}\\chnnl\u201d . \n\nOnce executed, the malware checks for the presence of a mutex (XSQWERSystemCriticalSection_for_1232321) to make sure that another \ninstance of itself is not already running.  After that, it contacts the server (the IP: 198.[redacted].74 or the domain name sec[redacted]win.\ncom). During the initial communication, the backdoor sends an encrypted buffer to the C&C server that contains a RC4 key and the IDs of \nthe plugins it has installed. The buffer is shown below:\n\n03 33 02 03 33 23 03 21 23 06 21 23 3A 66 95 64 4B 56 FF 22 4D 81 4F\n\nWe can identify plugins with the following ids from the buffer above: 0x3302, 0x3303, 0x2103, 0x2106\n\nAn interesting aspect of the pr.dll is that it creates two pipes that are presumably used to collect data sent by other processes.\n\nThe  pr.dll  seems  to  be  a  Windows  version  of  a  Linux  file  found  on  the  server.  The  server  hosts  4  elf  files,  two  built  for  the  x86 \narchitecture  (075b6695ab63f36af65f7ffd45cccd39,  f3bf929a35c3f198226b88537d9ccb1a)  and  two  for  the  x64  architecture \n(2683624eacc490238e98c449bddbb573, 5bf524a4860f3c33e3ad77b6b625db37). The elf file uses SQLite3 rather than Registry \nto store its configuration. The database named My_BD holds two values chnnl and prms. \n\nThe  files  attempt  to  contact  the  server  by  constructing  random  requests.  Each  request  is  made  of  one  of  the  verbs  (watch/,  search/, \nresults/,  search/,  close)  and  two  to  nine  arguments  (selected  from  the  list:  text=,  from=,  itwm=,  ags=,  oe=,  aq=,  btnG=,  oprnd=,  utm=, \nchannel=). The values of the arguments are randomly generated.\n\nAn example of a request is given below:\n\nh[tt]p://198.***.***.74/watch/?aq=JTfJRp-s&oprnd=Dwtee&itwm=niKMuGE9Mp9Md9vHdggZMS16YlSTx&btnG=t&oprnd=FbLtw&AVVAT=m\n8I2tN\n\nThe elf files contain the following modules:\n1. AgentModule\n2. KernelProvider\n3. AgentKernel\n4. ChannelController\n5. Cryptor\n6. LocalStorage (sqlite3)\n7. ReserverApi\n8. AgentChannel\n9. HttpChannel\n10. FSModule\n11. RemoteShell  \n12. RemoteKeylogger \n\nAs stated above, there are two versions for each architecture. The only difference between them is that one version does not include the \nlast two modules.\n\n[24]\n\nWhite Paper\fAbout the Authors\n\nR\u0103zvan Benchea has been working as a malware researcher for more than eight years. He is an associate professor at the Alexandru Ioan \nCuza university of Ia\u015fi where he teaches operating systems and assembly language. R\u0103zvan\u2019s areas of expertise includes APT forensics \nand reverse engineering. His academic accomplishments include a PhD in machine learning algorithms for malware detection.\n\nAlexandru  Maximciuc  spent  the  past  10  years  doing  antimalware  research  at  Bitdefender.  He  is  an  expert  in  reverse  engineering  and \ncryptanalysis. Alexandru has played a key role in the analysis and mapping of the PushDO botnet and is in charge with the automation of \nsinkholing operations.\n\nCristina Vatamanu is a malware researcher with a focus on botnets. With more than six years of experience in reverse engineering, exploit \nanalysis and cryptography, Cristina has brought her contribution to the threat intelligence scene at conferences such as AVAR and Virus \nBulletin.\n\nVictor Luncasu is a junior malware researcher focused on algorithms and data structures. His experience includes reverse engineering and \npayload analysis as well as custom communication protocols between bots and command & control servers.\n\n[25]\n\nWhite Paper \n\fBitdefender is a global security technology company that delivers solutions in more than 100 countries through a network of value-added alliances, distributors and \n\nreseller partners. Since 2001, Bitdefender has consistently produced award-winning business and consumer security technology, and is a leading security provider in \n\nvirtualization and cloud technologies. Through R&D, alliances and partnership teams, Bitdefender has elevated the highest standards of security excellence in both its \n\nnumber-one-ranked technology and its strategic alliances with the world\u2019s leading virtualization and cloud technology providers. More information is available at  \n\nhttp://www.bitdefender.com/\n\nAll Rights Reserved. \u00a9 2015 Bitdefender. All trademarks, trade names, and products referenced herein are property of their respective owners.   \nFOR MORE INFORMATION VISIT: enterprise.bitdefender.com\n\n5\n8\n5\n0\n7\n\n:\n\n.\n\n.\n\n#\nk\nT\n-\n5\n1\n0\n2\n7\n1\nc\ne\nD\n-\ns\ns\ne\nn\ns\nu\nB\nD\nB\n\n-\n\ni\n\n\f"], "URLs": ["http://blog.gentilkiwi.com/mimikatz."], "weight": 0.0}