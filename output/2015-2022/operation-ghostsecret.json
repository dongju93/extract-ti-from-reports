{"rule_id": 643, "name": "operation-ghostsecret", "description": "-", "references": [], "File_Names": ["Iphlpapi.dll", "Apvapi32.dll", "Userenv.dll", "Proxysvc.dll", "Oleaut32.dll"], "MD5_Hashes": [], "SHA1_Hashes": ["33ffbc8d6850794fa3b7bccb7b1aa1289e6eaa45", "8f2918c721511536d8c72144eabaf685ddc21a35", "d0cb9b2d4809575e1bc1f4657e0eb56f307c7a76", "8a7621dba2e88e32c02fe0889d2796a0c7cb5144", "7fe373376e0357624a1d21cd803ce62aa86738b6", "fe887fcab66d7d7f79f05e0266c0649f0114ba7c"], "SHA256_Hashes": [], "Registry_Entries": ["HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\nProductName\nThis information is concatenated into a single string in the format:\n\u201cMAC_Address|ComputerName|ProductName\u201d and is sent to the control server\n\nRecording HTTP requests from the control server to the temporary file prx in the\nimplant\u2019s install directory with the current system timestamp\n\nAnalyzing the Main Implant\n\nThe February 2018 implant contains a wide variety of capabilities including data\nexfiltration and arbitrary command execution on the victim\u2019s system. Given the extensive\ncommand structure that the implant can receive from the control server, this is an\nextensive framework for data reconnaissance and exfiltration, and indicates advanced\nuse. For example, the implant can wipe and delete files, execute additional implants, read\ndata out of files, etc.\n\nThe implant begins execution by dynamically loading APIs to perform malicious activities.\n\nLibraries used to load the APIs include:\n\nKernel32.dll\nApvapi32.dll\nOleaut32.dll\nIphlpapi.dll\nWs2_32.dll\nWtsapi32.dll\nUserenv.dll\nNtdll.dll\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fThe main implant dynamically loading APIs.\n\nAs part of its initialization, the implant gathers basic system information and sends it to\nits hardcoded control server 203.131.222.83 using SSL over port 443:\n\nCountry name from system\u2019s locale\nOperating system version\nProcessor description from\n\nHKLM\\HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0\nProcessorNameString\n\nComputer name and network adapters information\nDisk space information for disks C: through Z: including total memory in bytes, total\navailable memory in bytes, etc.\n\nCurrent memory status including total physical memory in bytes, total available\nmemory, etc.\nDomain name and usernames based on current remote sessions\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fDomain name and username extraction using Win32 WTS APIs.\n\nData Reconnaissance\n\nThe implant receives commands over SSL as encoded data. This data is decoded, and the\ncorrect command ID is derived. Valid command IDs reside between 0 and 0x1D.\n\nSwitch case handling command execution based on command IDs.\n\nBased on the command ID, the implant can perform the following functions:\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fGather system information and exfiltrate to the control server (same as the basic data-\ngathering functionality previously described)\nGet volume information for all drives on the system (A: through Z:) and exfiltrate to the\ncontrol server\n\nGathering volume information.\n\nList files in a directory. The directory path is specified by the control server.\nRead the contents of a file and send it to the control server\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fReading file contents and sending it the control server.\n\nWrite data sent by the control server to a specified file path\n\nOpen handle to a file for writing with no shared permissions.\n\nWriting data received from control server to file.\n\nCreate new processes based on the file path specified by the control server.\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fCreating a new process for a binary specified by the control server.\n\nWipe and delete files specified by the control server\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fWiping and deleting files.\n\nExecute a binary on the system using cmd.exe and log the results into a temp file,\nwhich is then read and the logged results are sent to the control server. The command\nline:\n\ncmd.exe /c \u201c<file_path> > %temp%\\PM*.tmp 2>&1\u201d\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fExecuting a command and logging results to a temp file.\n\nGet information for all currently running processes\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fGetting process times for all processes on the system.\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fGetting username and domain from accounts associated with a running process.\n\nDelete itself from disk using a batch file.\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fCreating a batch file for self-deletion.\n\nStore encoded data received from the control server as a registry value at:\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\TowConfigs Description\n\nSet and get the current working directory for the implant\n\nSetting and getting the current working directory for the implant\u2019s process.\n\nThe command handler index table is organized in the implant as follows:\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\fThe command handler index table.\n\nConclusion\n\nThis analysis by the McAfee Advanced Threat Research team has found previously\nundiscovered components that we attribute to Hidden Cobra, which continues to target\norganizations around the world. The evolution in complexity of these data-gathering\nimplants reveals an advanced capability by an attacker that continues its development of\ntools. Our investigation uncovered an unknown infrastructure connected to recent\noperations with servers in India using an advanced implant to establish a covert network\nto gather data and launch further attacks.\n\nThe McAfee Advanced Threat Research team will provide further updates as our\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\finvestigation develops.\n\nFighting cybercrime is a global effort best undertaken through effective partnerships between the\npublic and private sectors. McAfee is working with Thai government authorities to take down the\ncontrol server infrastructure of Operation GhostSecret, while preserving the systems involved for\nfurther analysis by law enforcement authorities. By creating and maintaining partnerships with\nworldwide law enforcement, McAfee demonstrates that we are stronger together.  \n\nIndicators of Compromise\n\nMcAfee detection\n\nTrojan-Bankshot2\n\nMITRE ATT&CK techniques\n\nExfiltration over control server channel: data is exfiltrated over the control server\nchannel using a custom protocol\nCommonly used port: the attackers used common ports such as port 443 for control\nserver communications\nService execution: registers the implant as a service on the victim\u2019s machine\nAutomated collection: the implant automatically collects data about the victim and\nsends it to the control server\nData from local system: local system is discovered and data is gathered\nProcess discovery: implants can list processes running on the system\nSystem time discovery: part of the data reconnaissance method, the system time is\n\nalso sent to the control server\nFile deletion: malware can wipe files indicated by the attacker\n\nIP addresses\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\f203.131.222.83\n14.140.116.172\n203.131.222.109\n203.131.222.83\n\nHashes\n\nfe887fcab66d7d7f79f05e0266c0649f0114ba7c\n8f2918c721511536d8c72144eabaf685ddc21a35\n33ffbc8d6850794fa3b7bccb7b1aa1289e6eaa45 \n\n\uf104 Previous Article\n\nNext Article \uf105\n\n\uf07c Categories: McAfee Labs\n\uf02c Tags:   advanced persistent threats, cybercrime, cybersecurity, malware\n\nLeave a reply\n\nFacebook Comments (0) Comments (0) G+ Comments\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\f0 Comments\n\nSort by \n\nNewest\n\nAdd a comment...\n\nFacebook Comments Plugin\n\nLeave a Comment\n\nComment\n\nName *\n\nEmail *\n\nPlease enter an answer in digits:\n\neighteen \u2212 fifteen = \n\nPost Comment\nPost Comment\n\nAbout | Subscribe | Contact & Media Requests | Privacy Policy | Legal\n\n\u00a9 2018 McAfee LLC\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\uf099\n\n\uf09a\n\n\uf0e1\n\n\uf167 \uf0d5\n\n\f\uf002\uf002\n\nClose Menu\n\nSearch\n\nBusiness\nConsumer\nExecutive Perspectives\nMcAfee Partners\nMcAfee Labs\n\nLanguages\n\nEnglish\n\nFollow us\n\n\uf09a\n\n\uf099\n\n\uf16a \uf0d5 \uf0e1\n\n\uf09e\n\nAbout\n\nSubscribe\n\nContact & Media Requests\n\nPrivacy Policy\n\nLegal\n\n\u00a9 McAfee LLC\n\nPDF generated automatically by the PDFmyURL HTML to PDF API\n\n\f"], "URLs": ["https://t.co/8EWt6a9uo0", "https://t.", "https://t.co/t8nkOe4sSg"], "weight": 0.0}