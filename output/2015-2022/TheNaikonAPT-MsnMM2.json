{"rule_id": 1006, "name": "TheNaikonAPT-MsnMM2", "description": "-", "references": [], "File_Names": [], "MD5_Hashes": ["bf6d3f52ab8176122be858ddccc22148"], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\\nCurrentVersion\\InstallDate\n\nThese values are built into a\u00a0single string for\u00a0reporting. \n\nSslMM also maintains this code chunk and functionality but does not immediately \ninvoke it like winMM. Also interesting and different from sslMM, are the\u00a0decoy Word \ndocuments dropped by many of the\u00a0winMM droppers. Images of these documents \nare\u00a0shown in\u00a0the\u00a0Appendix. The documents are all written and formatted with a\u00a0spe-\ncially developed Myanmar2 True Type font, demonstrating the\u00a0focus on\u00a0politically-\nconnected, native Myanmar speakers as targets. This font is\u00a0not delivered by default \nwith Microsoft Office. Instead, it must have been specifically installed by the\u00a0attackers \nand then by the\u00a0victims, otherwise the\u00a0documents would not have displayed properly.\n\nThe backdoor maintains multiple primitive functionalities.\n\nSetting a\u00a0WH_CBT Windows hook for\u00a0full activity spying (sslMM does not maintain \nthis\u00a0hooking functionality):\n\n\u2022  File search and capture\n\n\u2022  Process creation\n\n\u2022  Keystroke capture \n\nThe backdoor is\u00a0usually configured with primary and backup domains for\u00a0C2 \ncommunications, although there are multiple known samples that maintain \nan IP address or only a\u00a0single domain for\u00a0communications with no backup. \nCommunication is\u00a0built to appear as though a\u00a0web browser is\u00a0simply making \na\u00a0request to a\u00a0remote web server. Some of these backdoors are configured \nto\u00a0use\u00a0an\u00a0unusual port for\u00a0encrypted communications.\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f14\n\nexe_exchange (used in\u00a0attacks prior to ~2012)\n\nMD5 \u2013 Filename\n\nFile Size\n\nCompilation date\n\nLinker version\n\n6a82c153bd370250cc2fed89f1bb5c91 - \n%temp%\\services.exe\n\n69,632 bytes\n\n2012-03-13 \n07:54:19\n\n6.0\n\nINJECTv1/INJECTRESOURCE\n\nMD5 \u2013 Filename\n\nFile Size\n\nCompilation date\n\nLinker version\n\nb295274423c91ad9e254475bf8edd459 - \nwmiprive.exe\n\n159,744 bytes May 27, 2013\n\nThe xsPlus/nokian backdoor and keylogger\n\nMD5 \u2013 Filename\n\nFile Size\n\nCompilation date\n\nLinker version\n\nd86106faaa398b8d83437176bf5e39c4\n\n281,624 bytes 2011.12.19 \n\n6.0\n\n08:06:30\n\nIn 2014 the\u00a0Naikon gang was found to be using another tool that maintains an internal \nname \u201cxsPlus\u201d and \u201cxsControl\u201d. This builder and its backdoors produce components \nwith the\u00a0\u201cNOKIAN95/WEBx\u201d user-agent strings, for\u00a0which there are multiple versions. \nIt\u2019s\u00a0functionality is\u00a0covered in\u00a0our previous Naikon APT post.\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f15\n\nNAIKON AND MINOR LINKS WITH APT30\n\nAnother interesting aspect of the\u00a0backdoor builder is\u00a0that it also provides a\u00a0keylogger \nplugin that is\u00a0used on\u00a0specific victim systems. And here there are minor, but striking, \nsimilarities with the\u00a0APT30 tools.\n\nCallback sessions for\u00a0stolen data include these URLs:\n\nPOST /stonehoof.rar/user=xxx&password=xxx \nGET /stonehoof.rar/user=xxx&password=xxx\n\nSome of the\u00a0collector components upload data in\u00a0SQLite3 format, while earlier versions \nof the\u00a0tool upload xml formatted data. Presenting a\u00a0similarity with the\u00a0APT30 artifacts, \ntheir callback domains included stonehoof.com, hosted on\u00a0several IPs during the\u00a0naikon \ncampaigns. This name is\u00a0very unusual, and it is\u00a0an odd coincidence that it is\u00a0shared by\u00a0two \ngeopolitically-focused cyber-espionage groups, both targeting the\u00a0South China Sea \nregion.\n\nAPT30 - stonehoof.com \n2012-10-07 \n2013-04-03 \n2013-04-14 \n\n208.77.46.251 \n174.36.159.165 \n219.90.115.251 \n\n174.36.159.165 \n219.90.115.251 \n174.36.159.164\n\nWhile the\u00a0MsnMM components include the\u00a0unusual \u201cMM\u201d in\u00a0internal names sslMM, \nwinMM, and wininetMM, some of the\u00a0strings in\u00a0the\u00a0APT30 GEMSTONE software include \nthe\u00a0same \u2013 search and retrieval of the\u00a0registry key \u201cSoftware\\Microsoft\\GetMM\u201d, and \nthree function names \u201cMicrosoftGMMExit, MicrosoftGMMHaveExit, MicrosoftGMMZJ\u201d. \nThe APT30 BACKSPACE backdoor also contains a\u00a0similar potential target reference, \nas\u00a0discussed in\u00a0the\u00a0FireEye paper.\n\n\u201cBACKSPACE Variant  Path  \nZJ Auto (version 1.4)  \n\n/autoMM/  \n\nPossible Target \nMyanmar\u201d\n\nSo, the\u00a0\u201cMM\u201d shared by both of these may be a\u00a0simple reference to Myanmar, the\u00a0starting \ntarget for\u00a0these Naikon APT attacks.\n\nAPT30 backdoors also add \u201cMSN.lnk\u201d shortcuts to the\u00a0Start Menu Startup location \nfor\u00a0persistence, just like the\u00a0MsnMM components spoof \u201cMsn Gaming Zone.lnk\u201d \nand\u00a0\u201cMsn Talk.lnk\u201d for\u00a0persistence.\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f16\n\nSys10 \n\nMD5 \u2013 Filename\n\nFile Size\n\nCompilation date\n\nLinker version\n\nc58df5892700ac3f467524f86bf325c0 - update.exe\n\n116.5 kb\n\n2013.02.01 \n07:39:12\n\n9.0\n\nYet another backdoor was used throughout 2013 by Naikon. Several of the\u00a0C2 \ndomains are shared with either Naikon or MsnMM infrastructure. This backdoor \nis\u00a0a\u00a0very basic initial component. To give an idea of the\u00a0sophistication of its develop-\nment, one of\u00a0the\u00a0decryption schemes it uses is\u00a0an xor 0x1 loop on\u00a0the\u00a0very begin-\nning of its .data\u00a0section to decrypt its C2 domain. In this case, 6C 6C 6A 62 66 2F \n74\u00a068 62 71\u00a02F\u00a06F 64 75 01 (lljbf/thbq/odu) \uf0e0 mmkcg.uicp.net.\n\nThis weak level of encryption is\u00a0odd, because other strings, like the\u00a0unicode version \nof the\u00a0callback url \u201cs.y.s.t.e.n.&.c.p.=.%.s.&.l.o.g.=.%.s.&.i.n.d.e.x.=.%.d.\u201d, are\u00a0maintained \nin\u00a0plaintext in\u00a0the\u00a0.rdata section. Perhaps the\u00a0authors thought xor\u2019ing the\u00a0domains \nwould hide their infrastructure for\u00a0as long as needed, or they were working with \nothers who didn\u2019t understand automated sandboxes and tracing but didn\u2019t want \nthe\u00a0dns strings present in\u00a0the\u00a0binary. It doesn\u2019t seem to make sense, but it appears \nto\u00a0have been effective enough to leave in\u00a0the\u00a0executables.\n\nFor all of the\u00a0\u201cSys10\u201d backdoors, URL parameters were used consistently for\u00a0the\u00a0initial \nC2 callback: \n\nsysten&cp=&log=&index=\n\nwhere: \n\n cp = system computername \nlog = signed decimal integer representation of the\u00a0OS InstallDate \nindex = simply the\u00a0return value from a\u00a0GetTickCount call\n\nThe backdoor collects several bits of identifying information to send to the\u00a0C2:\n\n\u2022  computer name\n\n\u2022  account name of logged-in user\n\n\u2022  group name of logged-in user\n\n\u2022  local IP address\n\n\u2022  OS versioning information\n\n\u2022  OS install date\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f17\n\nThe backdoor maintains a\u00a0simple set of primitives:\n\n\u2022  http-based communications with hardcoded C2 \n\n\u2022  download additional components\n\n\u2022  start a\u00a0new process\n\n\u2022  terminate a\u00a0running process\n\n\u2022  find files and copy them\n\n\u2022  delete files\n\n\u2022  create files\n\nWe detected this backdoor on\u00a0multiple victim workstations with the\u00a0following verdicts:\n\nTrojan.Win32.Agentb.hyb \nTrojan.Win32.Agentb.iqj \nBackdoor.Win32.MsnMM.p \nUDS:DangerousObject.Multi.Generic \nTrojan.Win32.Agentb.jwp\n\nAccording to KSN (Kaspersky Security Network) \ndata, almost all of the\u00a0victims attacked with \nthis backdoor are based in\u00a0Myanmar, or \nwere Myanmar delegates travelling through \nthe\u00a0other countries like the\u00a0US, for\u00a0example. \nSome of the\u00a0victims were located in\u00a0Vietnam \nand Singapore. Victim profiles range from \nglobal political representatives and local IT \nservice companies, to government ministries \ncontrolling media and news content, university \nstudents, and local law enforcement agencies.\n\nWininetMM/Sakto\n\nMD5 \u2013 Filename\n\nFile Size\n\nCompilation date\n\nLinker version\n\n516f64dd4fce3b9a325ea8501f97a88a \n\n95,744 bytes \n\n2014.11.03 \n07:59:14 \n\n9.0\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f18\n\nSECOND STAGE TOOLS\n\nMost of the\u00a0Naikon APT\u2019s second stage tools detected on\u00a0victim networks are publicly-\navailable. Some are very common system administration tools and utilities, and some \nare less publicly-available custom written scanners and tools available through Chinese \nhacking forums. Their ability to move through networks undisturbed appears to have \nmatured over time, demonstrating that they are a\u00a0seasoned team:\n\n\u2022  Windows system utilities: ftp.exe, systeminfo.exe, ipconfig, net view, ping, netstat \n\n-ano, net use, quser, tasklist, netsh interface ip, netsh interface show, netsh \nadvfirewall firewall, reg export, AT\n\n\u2022  Sysinternals: procmon.exe, tcpview.exe, procexep.exe, psexec\n\n\u2022  Prosolve: winscan.exe\n\n\u2022  Rarlabs: rar.exe\n\n\u2022  Other: procex.exe, nc.exe, xscan.exe, winscanx.exe, hscan120.rar package (includes \nmysql.exe and sqlcmd.exe), cutfile.exe, tftp.exe, Win7 elevation of privilege and UAC \nbypass, ReadPSW.exe (password stealer)\n\nThe Naikon APT frequently used a\u00a0custom backdoor that appears to be an HDoor \nvariant, based on\u00a0old \u201cHonker Union\u201d code like \u201chscan v120\u201d. For example, once \non\u00a0a\u00a0victim network, one of the\u00a0first steps is\u00a0to run the\u00a0hdoor -hbs scan to identify \ntarget local network hosts. Alternatively, it may show up on\u00a0victim networks and \nbe\u00a0run with a\u00a0long list of parameters:\n\n\u201clms.dat -hscan 192.168.0.1-192.168.0.254 /a\u201d\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f19\n\nCUSTOM HDOOR \n\nMD5 \u2013 Filename\n\nFile \nSize\n\nCompilation \ndate\n\nDetection Name\n\nbf6d3f52ab8176122be858ddccc22148 - lms.dat\n\n56 kb\n\n2015.05.20\n\nHackTool.Win32.Agent.whj\n\nThe Naikon APT\u2019s custom-built HDoor tool is\u00a0a\u00a0robust reconnaissance tool for\u00a0lateral \nmovement, supporting the\u00a0identification of, interfacing with and attacking of multiple \ntechnologies and resources:\n\n\u2022  host, user, group, and related authentication resources and cracking/brute forcing \n\ncapabilities\n\n\u2022  network asset scanning and identification, including SQL database, embedded \n\nnetwork devices like home or SMB routers, and other common network services\n\n\u2022  fake service listener to sniff traffic\n\n\u2022  disk wiping \u2013 safe delete with multiple overwrites\n\n\u2022  process management\n\n\u2022  local filetime modifier\n\n\u2022  SQL administration toolset\n\n\u2022  SOCKS5 proxy service\n\n\u2022  banner-based scanner\n\n\u2022  AV killer\n\nPublicly-available hd.exe (40138f3db14e6e137f8d0bdcbb5851d8), as posted by NCPH:\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f20\n\nThe corresponding hbs.txt output file content that is\u00a0sometimes left behind on\u00a0victim \nsystems:\n\nThe operator\u2019s scanning is\u00a0somewhat inconsistent. They will scan for\u00a0a\u00a0specific set \nof\u00a0ports that include 21,22,80,3389,1433,3306, and 389. Sometimes, they add 139 \nand 445 to the\u00a0end of that list. Often, they check for\u00a0a\u00a0\u201cPortString\u201d, or banner, which \nis\u00a0output to a\u00a0txt file:\n\n[10.1.1.2 ]: Port 22 Open!!! SSH-1.99-Cisco-1.25\n[10.1.1.3 ]: Port 21 Open!!! 220-FileZilla Server version 0.9.41 beta\n[10.1.1.4 ]:  Port 21 Open!!! 220 Lexmark X860de FTP Server NP.APS.N332a ready.\n[10.1.1.5 ]: Port 22 Open!!! SSH-2.0-OpenSSH_5.8\n[10.1.1.6 ]: Port 22 Open!!! SSH-2.0-dropbear_0.48\n[10.1.1.7 ]: Port 21 Open!!! 220 Service ready for\u00a0new user\n[10.1.1.8 ]: Port 21 Open!!! 220 Microsoft FTP Service (Version 5.0).\n[10.1.1.8 ]: Port 80 Open!!! \n[10.1.1.8 ]: Port 3389 Open!!! \n[10.1.1.8 ]: Port 139 Open!!! \n[10.1.1.9 ]: Port 21 Open!!! 220 fima FTP server (SunOS 5.8) ready.\n[10.1.1.10 ]: Port 21 Open!!! 220 (vsFTPd 2.0.5)\n[10.1.1.13 ]:  Port 21 Open!!! 220 EthernetBoard OkiLAN 8100e Ver 02.15 FTP server.\n[10.1.1.15 ]:  Port 22 Open!!! SSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.1\n[10.1.1.21 ]:  Port 80 Open!!! http://10.1.1.21/cgi-bin/webproc Dlink WIRELESS AP\n\nThe MsnMM CampaignsThe Earliest Naikon APT Campaigns TLP WhiteFor full indicator and other details, please contact intelreports@kaspersky.com\f21\n\nTARGET AND VICTIM PROFILES\n\nTarget profiles included high profile government and military agencies around \nthe\u00a0South\u00a0China Sea:\n\n\u2022  Law enforcement\n\n\u2022  Government \u2013 executive, administrative, regulatory\n\n\u2022  Military \u2013 operations centers\n\n\u2022  Economic administration\n\n\u2022  State media\n\n\u2022  Public/Private energy\n\n\u2022  Shared Victims with Cycldek and Comparing Lateral Movement with Cycldek\n\nThe Cycldek APT appeared to follow an operational script across victim systems. \nIt\u00a0created or used c:\\intel on\u00a0the\u00a0victim hard disk to unpack tools and compress/\narchive stolen victim files and data with Winrar, like "], "URLs": ["http://www.apcss.org/)", "http://www.aspistrategist.", "http://www.apcss.org/wp-content/uploads/2013/01/finalfinalhandbookJan13.pdf,"], "weight": 0.0}