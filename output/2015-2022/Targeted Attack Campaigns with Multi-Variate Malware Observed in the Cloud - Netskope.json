{"rule_id": 62, "name": "Targeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud - Netskope", "description": "-", "references": [], "File_Names": ["ScreenToGif.The", "deobfuscated.The", "example.com", "reg.exe", "Backdoor.Agnt", "Generic.JS", "netskope.com", "javaw.exe", "Variant.Rzy", "Downloadr.DPW"], "MD5_Hashes": ["6968F0AF128C27C6C970ADC0B301D204", "7340efcb3b352cd228a77782c74943a4", "5fcaf61df7fb44c984e5c5dcb9d2022a", "52de0df53e1d56e3bff153bcfd8d1938", "4506342ab7723d1f4cc6c98482c93433", "a3ffac9e74fa99291d4d53ef525ed0fd"], "SHA1_Hashes": [], "SHA256_Hashes": [], "Registry_Entries": ["HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN\u201d; Key: \u201cHP\u201d; Value:\n\u201c\u201d%APPDATA%\\Oracle\\bin\\javaw.exe\u201d -jar \u201c%USERPROFILE%\\QI\\giwauQII.cvLwffAX\u201d\u201d)\n\nThe jar \ufb01le constructs multiple VB scripts onto the disk, which are executed by launching an\ninstance of command prompt. These visual basic scripts creates WMI command line queries and\nchecks for system information like anti-virus programs, \ufb01rewall settings etc. A snapshot of the\nscripts is shown in \ufb01gure 6. Adwind also copies relevant Java Runtime \ufb01les to Appdata using\nxcopy command.\n\nFigure 6: VB scripts created by the RAT to gather system information\n\nThe sample tried connecting to a dynamic dns domain, securitypoint[.]ddns[.]net. Hosting C&C\nservers on dynamic DNS services helps attackers in quickly switching their IPs without changing\nthe host.\n\nPayload Variation 2 : iSpy Keylogger\n\nSample hash: 52de0df53e1d56e3bff153bcfd8d1938\nNetskope detection: Gen:Variant.Rzy.73941\n\nThe next instance of malware was observed to be the popular iSpy keylogger, which is sold in a\n\u00a0subscription based model in underground forums. iSpy is a .Net compiled keylogger that comes\npacked with loads of additional features like stealing browser history, webcam logging, keystroke\nrecording, clipboard monitoring etc. Figure 7 shows the captured strings in memory when the\nkeylogger is installed onto the system.\n\nhttps://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud\n\n7/11\n\n\f10/2/2019\n\nTargeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud - Netskope\n\nhttps://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud\n\n8/11\n\n\f10/2/2019\n\nTargeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud - Netskope\n\nFigure 7: iSpy keylogger activities captured in memory strings\n\nUpon execution, the malware creates a copy of itself in \\App\nData\\Roaming\\Microsoft\\Windows\\ScreenToGif.The malware maintains persistence by creating\nregistry entries in HKU\\.DEFAULT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell\nFolders\\Cache. The entry is made to invoke a payload activator executable that checks for\nrunning instances of the main iSpy payload based on the mutex. If the malware is not already\nloaded in the memory, It will launch its new instance. The payload loader is stored in the\n%TEMP% directory. Parts of the decompiled code can be seen in Figure 8.\n\nFigure 8: Payload loader\u2019s decompiled code\n\nThe code will look for running instance of process named \u201cnetprotocol\u201d and sleeps if it is already\nloaded into the memory. It will spun up a new process by invoking the copy of malware stored in\nthe ScreenToGif folder.\n\nApart from the keylogging and information stealing features, iSpy also makes sure that it disables\nany known running instances of a wide variety of anti-virus programs onto the system as shown in\nFigure 9.\n\nFigure 9: Process names of anti-virus solutions targeted by iSpy keylogger\n\nThe bene\ufb01t of using a cloud security solution like Netskope is that they are not affected by such\ncounter-measures implemented by sophisticated malware.\n\nhttps://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud\n\n9/11\n\n\f10/2/2019\n\nTargeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud - Netskope\n\nThe malware stores the ex\ufb01ltrated data in a \ufb01le in the %TEMP% directory and sends the\nharvested data to the C&C, westech-solar[.]co. At the time of analysis, the C&C was\nunresponsive.\n\nPayload Variation 3: Variant of Locky/Zepto\n\nSample hash: 6968F0AF128C27C6C970ADC0B301D204\nNetskope detection: Backdoor.Agnt.CDQB\n\nThe third and last payload noticed during our monitoring, belongs to Locky ransomware family.\nWe observed a variant of Locky being delivered as the \ufb01nal payload once the user executes the\nattached JavaScript. We have blogged about a detailed analysis of the variant Zepto here. The\nsamples noticed during this campaign were no different from the one we disclosed in our blog.\nThere were slight variations in the \ufb01rst level JavaScript where the payload execution parameters\nwere slightly obfuscated.\n\nFigure 10: Ransom message from Locky/Zepto\n\nConclusion\n\nSending malicious attachments through emails is not new, but remains a very popular method for\ndelivering targeted attacks. By crafting an attack vector that leaves little for many existing\nenterprise security solutions, it becomes easy for attackers to infect users and network.\nOrganizations using cloud storage apps further amplify the attack vector when the malicious \ufb01les\nand payloads is synced across multiple users.\n\nGeneral recommendations\n\nNetskope recommends following course of actions to effectively counter such threats:\n\nDetect and remediate all threats at rest in sanctioned cloud services using a threat-aware\nCloud Access Security Broker like Netskope.\nDetect and remediate all threats being downloaded from unsanctioned cloud services using\na threat-aware solution like Netskope.\n\nhttps://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud\n\n10/11\n\n\f10/2/2019\n\nTargeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud - Netskope\n\nScan \ufb01les using remote scanning services like Netskope Advanced Threat Protection, that\ncannot be disabled by malware.\nRegularly back up and turn on versioning for critical content in cloud services.\nAvoid opening email attachments if it appears to be coming from unknown sources.\nDisable automatic unzipping of \ufb01les and avoid clicking on any JavaScript that comes as\nzipped archive unless fully veri\ufb01ed by the sender or IT administrator.\nActively track usage of unsanctioned cloud services and enforce DLP policies to control\n\ufb01les and data entering and leaving your corporate environment.\nKeep systems and antivirus updated with the latest releases and patches.\n\nContact Us\n\nWe'd love to hear from you!\n\nhttps://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud\n\n11/11\n\n\f"], "URLs": ["https://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud"], "weight": 0.0}