{"rule_id": 454, "name": "Mikroceen_ Spying backdoor leveraged in high\u2011profile networks in Central Asia _ WeLiveSecurity", "description": "-", "references": [], "File_Names": ["7B296FB0.CAB", "WeLiveSecurity.com", "W52G86ST.TMP", "Agent.NE", "Far\ufb02i.CSY", "pcaudit.dll", "5E8C6FF0.CAB"], "MD5_Hashes": ["7771e1738fc2e4de210ac06a5e62c534"], "SHA1_Hashes": [], "SHA256_Hashes": ["383a2d8f421ad2f243cbc142e9715c78f867a114b037626c2097cb3e070f67d6"], "Registry_Entries": ["HKLM\\SYSTEM\\CurrentControlSet\\Services\\PCAudit\\Parameters /v ServiceDll /t REG_EXPAND_SZ /d %SystemRoot%\\Sys\u2010\nwow64\\pcaudit.dll\n\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Services\\PCAudit\\Parameters /v ServiceMain /t REG_SZ /d NtHelpServiceMain\n\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Services\\PCAudit\\Parameters /v ServiceDllUnloadOnStop /t REG_DWORD /d 1\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\nsc start PCAudit\n\ndel %0\n\nFigure 4. Installation batch code\n\nAs we mentioned earlier, each bot comes with con\ufb01guration data: C&C, client name and client password. The name of the bot appears in the server-side\ninterface. What is quite unusual is that an operator needs to authenticate by entering the client\u2019s password in order to control the client. We can only speculate\nabout the purpose, but it could serve as protection against botnet takeover, in case a competing actor or law enforcement seize their infrastructure. So, we see\nthat certain effort was put on the security of the client-server connection. Moreover, the client can connect directly to the C&C server or route the traf\ufb01c via a\nproxy, which could be useful \u2013 especially in corporate networks. The connection is further secured by a certi\ufb01cate and this is a feature that distinguishes\nMikroceen from the legion of backdoors we have seen since previously.\n\nMikroceen uses the same basic features as already described Palo Alto Networks about BYEBY. The grammar of commands is quite speci\ufb01c, because each\ncommand is truncated to 6 letters and then base64 encoded. That results an 8-letter incomprehensible word in the code. While in previous cases the encoding\nwas straightforward, in the campaign in Central Asia there\u2019s additional unknown encryption layer added. The connection of the 8-letter words with the\ncommands in that case was done by agreement on the code level.\n\nCommand\n\nhello!\n\nGOODBY\n\nBYE BY\n\nMicrocin, BYEBY, Vicious Panda\n\nMikroceen\n\naGVsbG8h\n\nR09PREJZ\n\nQllFIEJZ\n\nAmbZDkEx\n\neYTS5IwW\n\nbo7aO8Nb\n\nhttps://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro\ufb01le-networks-central-asia/\n\n2/7\n\n\f5/15/2020\n\nMikroceen: Spying backdoor leveraged in high-pro\ufb01le networks in Central Asia | WeLiveSecurity\n\nCommand\n\nDISCON\n\nLIST D\n\nSTARTC\n\nCOMMAN\n\nMicrocin, BYEBY, Vicious Panda\n\nMikroceen\n\nRElTQ09O\n\nTElTVCBE\n\nU1RBUlRD\n\nQ09NTUFO\n\n6GEI6owo\n\nKi0Swb7I\n\nh71RBG8X\n\n5fdi2TfG\n\nTRANSF + (UPLOAD, DOWNLO) VFJBTlNG + (VVBMT0FE, RE9XTkxP)\n\nJ8AoctiB + (QHbU0hQo, hwuvE43y)\n\nEXECUT\n\nRVhFQ1VU\n\ngRQ7mIYr\n\nTable 1. Command grammar of various instances of the RAT\n\nDuring execution, the client logs debug messages in a temporary \ufb01le. This varies among various Mikroceen instances. Table 2 provides a comparison of these\nmessages from case to case and gives additional evidence that links the instances of Mikroceen.\n\nMicrocin\n\nBYEBY\n\nVicious Panda\n\nMikroceen\n\nFolder\n\n%\nCSIDL_COMMON_DOCU\u2010\nMENTS%\n\n%TEMP%\n\n%\nCSIDL_COMMON_DOCU\u2010\nMENTS%\n\n32-bit\n\n64-bit\n\n%TEMP%\n\n%TEMP%\n\nFilename\n\n7B296FB0.CAB\n\nvmunisvc.\u2010\ncab\n\n5E8C6FF0.CAB\n\n7B296FB0.CAB W52G86ST.TMP\n\nKeywords at\nmain\n\nKeyword at\nconnect\n\nV09SS0lO\nU3RhcnQ=\n\nZGlyZWN0\n\nTable 2. Logging messages in a temporary \ufb01le\n\nSimultaneously occurring malware\n\nV09SS0lO \nU3RhcnQ=\n\nV09SS0lO \nU3RhcnQ=\n\nV09SS0lO\n\nGvFa8Sei\n\nZGlyZWN0\n\nZGlyZWN0\n\nwfZ155bJ\n\nwfZ155bJ\n\nThe previous reports always mention a wide arsenal of tools that are used in the attacks. In our case it was the same \u2013 not just Mikroceen, but other malware\nas well. Here are the three most important tools we observed in the compromised networks.\n\nLateral movement via Mimikatz\n\nThe attackers used their implementation of Mimikatz, delivered via a two-stage mechanism: the \ufb01rst stage was a dropper usually called installer.exe or\nYokel64.exe, which dropped the main payload with an indicative external DLL name mktz64.dll in the second stage. While Mikroceen has never come with\ndebug information, here we can see the string E:\\2018_\\MimHash\\mimikatz\\Bin\\mktzx64.pdb\n\nFigure 5. A PDB string in the Mimikatz payload\n\nMimikatz is an open source project by French security researcher Benjamin Delpy, developed since 2007. It\u2019s a robust tool that, among other things, can\nbypass various Windows authentication schemes, basically by dumping credential data from the Windows Local Security Account database. It\u2019s mainly used\nby red teams in IT security but also misused across the spectrum of APT actors, e.g. Lazarus Group, Telebots, Okrum etc. After running it in a test virtual\nenvironment, its output is (the incorrect spaces before the commas are in the original):\n\n1\n\n2\n\n#1 domain = MSEDGEWIN10, user = Administrator , nthash=FC525C9683E8FE067095BA2DDC971889.\n\n#2 domain = MSEDGEWIN10, user = IEUser , nthash=FC525C9683E8FE067095BA2DDC971889.\n\nLateral movement via WMI\n\nThe attackers use an additional tool to spread in the hosting network. This time they leverage Windows Management Instrumentation (WMI). All relevant data\nis needed as the \ufb01le\u2019s name, as during the execution it expects @@<ComputerName>,<UserName>,<Password>,.exe.\u00a0 In the \ufb01rst step, a console to a remote\ncomputer is established, where the connection is identi\ufb01ed by <ComputerName> and authenticated with (<UserName>, <Password>). Afterwards, proxy\n\nhttps://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro\ufb01le-networks-central-asia/\n\n3/7\n\n\u00a0\n\f5/15/2020\n\nMikroceen: Spying backdoor leveraged in high-pro\ufb01le networks in Central Asia | WeLiveSecurity\n\nsecurity is set to the strict level, which means arguments of each remote procedure call are encrypted and the server\u2019s access to local resources is allowed.\nThen WMI is used again to retrieve the Win32_Process class, which in turn is used to create a process with given parameters. When all the work is done, the\ntool terminates itself.\n\nGh0st RAT\n\nThis infamous, old RAT was created around 2008. In this instance it was found as rastls.dll on the compromised systems, while the exported DLL name is\nusually svchost.dll. It tries to connect with https://yuemt.zzux[.]com:443, which resolves to an IP address in China. This is an exception with no explanation,\nbecause the server doesn\u2019t belong to any of the C&C providers used by Mikroceen. From our point of view, it seems redundant to use this additional backdoor,\nwhose capacity is fully provided by Mikroceen itself.\n\nTo recognize this backdoor, one observes the string Gh0st within the binary. The character string uwqixgze} is used as a placeholder for the C&C domain. \n\nC&C panel (server-side interface)\n\nFigure 6. Gh0st RAT malware (fragment)\n\nThe previous reports already mention the poor operational security of the attackers (their open directories were observed by Kaspersky and Checkpoint), and\nthe actors behind continue to leak tools not necessarily leveraged on the victims\u2019 side. We were able to get our hands on an older version of RAT\u2019s control\npanel. \u00a0On the lower part of Figure 7 there\u2019s a graphical interface through which all bots are commanded. It is very minimalistic, which may be due to an older\nversion from 2017, but still, just compare it with the greater than 10-year-old panel of Gh0st RAT. There\u2019s not much improved since, visually or functionally, so\nthe introduction of SSL connections seems like the main shift between the projects (the text box for \u201cCN Name\u201d on the \ufb01gure). It seems that the operators of\nthe botnet are content customers of Vultr services, a child company of Choopa LLC, as their operational infrastructure is mostly hosted there, and this was also\nobserved in the Vicious Panda campaign by Checkpoint. This is a bullet-proof provider, documented by researchers from Cisco as early as 2015.\n\nhttps://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro\ufb01le-networks-central-asia/\n\n4/7\n\n\f5/15/2020\n\nMikroceen: Spying backdoor leveraged in high-pro\ufb01le networks in Central Asia | WeLiveSecurity\n\nFigure 7. Interfaces for controlling bots: Gh0st RAT (2008) vs. Mikroceen\u2019s interface (2017)\n\nConclusion\n\nWe have presented the analysis of a custom implementation of a client-server model developed for spying purposes. The malware developers put great effort\ninto the security and robustness of the connection with their victims and the operators managed to penetrate high-pro\ufb01le corporate networks. Moreover, they\nhave a larger toolset of attack tools at their disposal and their projects are under constant development, mostly visible as variations in obfuscation.\n\nIndicators of Compromise (IoCs)\n\nHere are the hashes of samples described in the article. Additional IoCs collected from the attacks can be found on ESET\u2019s GitHub or Avast\u2019s GitHub.\n\nSHA\n\nd215bb8af5581b31f194248fc3b\u2010\nd13d999a5991c\n\n7a63fc9db2bc1e9b1e\u2010\nf793723d5877e6b4c566b8\n\nTime\u2010\nstamp\n\n2016-\n06-29\n00:34:42\n\n2017-\n07-06\n08:15:31\n\nDescription\n\nMicrocin (Kaspersky)\n7771e1738fc2e4de210ac06a5e62c534\n\nESET detection name\n\nWin32/Mikroceen.A\n\nBYEBY (PANW)\n383a2d8f421ad2f243cbc142e9715c78f867a114b037626c2097cb3e070f67d6\n\nWin32/Mikroceen.B\n\nhttps://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro\ufb01le-networks-central-asia/\n\n5/7\n\n\f5/15/2020\n\nMikroceen: Spying backdoor leveraged in high-pro\ufb01le networks in Central Asia | WeLiveSecurity\n\nSHA\n\n2f80f51188d\u2010\nc9aea697868864d88925d64c26abc\n\n302cf1a90507efbd\u2010\ned6b8f53e380591a3eaf6dcb\n\n21ffd24b8074d7cffdf4cc339d1\u2010\nfa8fe892eba27\n\n5192023133dce042\u2010\nda8b6220e4e7e2e0dcb000b3\n\nc18602552352fee592972603262fe1\n5c2cdb215a\n\n4de4b662055d3083a1bc\u2010\ncf2bc49976cdd819bc01\n\nTime\u2010\nstamp\n\n2017-\n01-28\n11:33:43\n\n2019-\n04-25\n01:15:40\n\n2018-\n12-10\n07:46:25\n\n2019-\n03-11\n12:14:09\n\n2015-\n03-16\n03:29:39\n\n2015-\n12-31\n03:10:15\n\nReferences\n\nDescription\n\nVicious Panda (Checkpoint)\n\nMikroceen 32-bit\n\nMikroceen 64-bit\n\nMimikatz\n\nESET detection name\n\nWin32/Mikroceen.C\n\nWin32/Mikroceen.H\n\nWin64/Mikroceen.C\n\nWin64/Riskware.Mimikatz\n\nLateral Movement via WMI\n\nWin32/HackTool.Agent.NE\n\nGh0st RAT\n\nWin32/Far\ufb02i.CSY\n\nVasily Berdnikov, Dmitry Karasovsky, Alexey Shulmin: \u201cMicrocin malware\u201d, Kaspersky Labs 2017-9-25\nJosh Grunzweig, Robert Falcone: \u201cThreat Actors Target Government of Belarus Using CMSTAR Trojan\u201d, September 2017\nCheckpoint Research: \u201cVicious Panda: The COVID Campaign\u201d, 2020-03-12\nSecDev Group & Citizenlab, \u201cTracking GhostNet: Investigating a Cyber Espionage Network\u201d, March 2009,\nDhia Mahjoub, Jeremiah O\u2019Connor, Thibault Reuille, Thomas Mathew: \u201cPhishing, Spiking, and Bad Hosting\u201d, Cisco Umbrella Blog, 2015-09-14\n\u201cMimikatz: A little tool to play with Windows security\u201d\nPeter K\u00e1lnai, Anton Cherepanov. \u201cLazarus KillDisks Central American casino\u201d, WeLiveSecurity.com, April 2018\nAnton Cherepanov, Robert Lipovsk\u00fd: \u201cNew TeleBots backdoor: First evidence linking Industroyer to NotPetya\u201d, WeLiveSecurity.com, October 2018\nZuzana Hromcov\u00e1: \u201cOkrum: Ke3chang group targets diplomatic missions\u201d, WeLiveSecurity.com, July 2019\nAvast Threat Intelligence, GitHub repository\nESET Threat Intelligence, GitHub repository\n\nMITRE ATT&CK techniques\n\nTactic\n\nID\n\nName\n\nDescription\n\nExecution\n\nT1035 Service Execution\n\nThe RAT is con\ufb01gured to run as a service at startup via sc.exe.\n\nT1059 Command-Line Interface\n\nThe RAT can execute a command line.\n\nT1064 Scripting\n\nThe attackers used batch scripts for malware installation and execution.\n\nT1105 Remote File Copy\n\nThe RAT can download \ufb01les to the victim\u2019s machine\n\nT1106 Execution through API\n\nThe RAT launches the Windows console via CreateProcess.\n\nPersistence\n\nT1050 New Service\n\nThe RAT is executed automatically\n\nDefense\nEvasion\n\nT1136 Masquerading\n\nThe RAT disguises itself as various types of legitimate services.\n\nT1140 Deobfuscate/Decode Files or\n\nInformation\n\nThe commands of the RAT and some of its components are\nencoded/encrypted.\n\nDiscovery\n\nT1082 System Information Discovery\n\nThe RAT sends information, like the version of the operating system to be\ndisplayed, in operator\u2019s panel.\n\nT1016 System Network Con\ufb01guration\n\nDiscovery\n\nThe RAT collects network information, including host IP address and proxy\ninformation.\n\nT1033 System Owner/User Discovery\n\nThe RAT sends information, like the username to be displayed, in operator\u2019s\npanel.\n\nT1103 Credential Dumping\n\nMimikatz is used in the attack.\n\nT1032 Standard Cryptographic Protocol\n\nThe RAT uses SSL for encrypting C2 communications.\n\nT1043 Commonly Used Port\n\nThe RAT uses port 443.\n\nCredential\nAccess\n\nCommand and\nControl\n\nhttps://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro\ufb01le-networks-central-asia/\n\n6/7\n\n\f5/15/2020\n\nMikroceen: Spying backdoor leveraged in high-pro\ufb01le networks in Central Asia | WeLiveSecurity\n\nTactic\n\nID\n\nName\n\nDescription\n\nT1071 Standard Application Layer\n\nThe RAT uses the Schannel implementation of SSL.\n\nProtocol\n\nT1001 Data Obfuscation\n\nThe RAT\u2019s interface controls the client with obfuscated commands.\n\nT1030 Proxy Connection\n\nThe RAT has a proxy option that masks traf\ufb01c between the malware and the\nremote operators.\n\nEx\ufb01ltration\n\nT1041 Ex\ufb01ltration Over Command and\n\nThe operator of the RAT can download any desired \ufb01le from a victim.\n\nControl Channel\n\nCollection\n\nT1113 Screen Capture\n\nThe RAT can capture the victim\u2019s screen.\n\nPeter K\u00e1lnai 14 May 2020 - 02:00PM\n\nhttps://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro\ufb01le-networks-central-asia/\n\n7/7\n\n\f"], "URLs": ["https://yuemt.zzux[.]com:443,", "https://www.welivesecurity.com/2020/05/14/mikroceen-spying-backdoor-high-pro"], "weight": 0.0}